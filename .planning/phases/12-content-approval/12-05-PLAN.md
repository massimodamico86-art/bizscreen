---
phase: 12-content-approval
plan: 05
type: execute
wave: 2
depends_on: ["12-01"]
files_modified:
  - src/components/dashboard/PendingApprovalsWidget.jsx
  - src/pages/DashboardPage.jsx
  - src/pages/dashboard/DashboardSections.jsx
autonomous: true

must_haves:
  truths:
    - "Dashboard shows pending approvals widget when user can approve"
    - "Widget lists pending reviews with content name and type"
    - "Clicking review item navigates to ReviewInboxPage or opens detail"
  artifacts:
    - path: "src/components/dashboard/PendingApprovalsWidget.jsx"
      provides: "Pending approvals widget component"
      min_lines: 60
    - path: "src/pages/DashboardPage.jsx"
      provides: "Widget integration on dashboard"
      contains: "PendingApprovalsWidget"
  key_links:
    - from: "src/pages/DashboardPage.jsx"
      to: "src/components/dashboard/PendingApprovalsWidget.jsx"
      via: "component import and render"
      pattern: "PendingApprovalsWidget"
    - from: "src/components/dashboard/PendingApprovalsWidget.jsx"
      to: "src/services/approvalService.js"
      via: "fetchOpenReviews call"
      pattern: "fetchOpenReviews"
---

<objective>
Create pending approvals dashboard widget for approvers.

Purpose: Per user decision, approvers access the review queue from their main dashboard via a widget (not a separate page). This provides quick access to pending submissions (APR-02).

Output: PendingApprovalsWidget component integrated into DashboardPage.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/12-content-approval/12-RESEARCH.md
@.planning/phases/12-content-approval/12-01-SUMMARY.md

# Dashboard patterns
@src/pages/DashboardPage.jsx
@src/pages/dashboard/DashboardSections.jsx

# Approval service
@src/services/approvalService.js
@src/services/permissionsService.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PendingApprovalsWidget component</name>
  <files>src/components/dashboard/PendingApprovalsWidget.jsx</files>
  <action>
Create the PendingApprovalsWidget component:

```jsx
/**
 * PendingApprovalsWidget.jsx
 * Dashboard widget showing pending content awaiting approval.
 * Only visible to users who can approve content (owners, managers).
 */
import { useState, useEffect } from 'react';
import {
  Clock,
  ListVideo,
  Layout,
  Zap,
  Film,
  ChevronRight,
  Loader2,
  CheckCircle,
} from 'lucide-react';
import { Card, Badge, Button } from '../../design-system';
import { fetchOpenReviews, REVIEW_STATUS } from '../../services/approvalService';
import { canApproveContent } from '../../services/permissionsService';
import { formatDistanceToNow } from 'date-fns';

// Icon mapping for resource types
const RESOURCE_ICONS = {
  playlist: ListVideo,
  layout: Layout,
  campaign: Zap,
  scene: Film,
};

/**
 * Single review item row
 */
function ReviewItem({ review, onNavigate }) {
  const Icon = RESOURCE_ICONS[review.resource_type] || ListVideo;
  const timeAgo = review.requested_at
    ? formatDistanceToNow(new Date(review.requested_at), { addSuffix: true })
    : '';

  return (
    <button
      onClick={() => onNavigate('review-inbox', { reviewId: review.id })}
      className="w-full flex items-center gap-3 p-2 rounded-lg hover:bg-gray-50 transition-colors text-left"
    >
      <div className="p-2 bg-yellow-50 rounded-lg flex-shrink-0">
        <Icon className="w-4 h-4 text-yellow-600" />
      </div>
      <div className="flex-1 min-w-0">
        <p className="text-sm font-medium text-gray-900 truncate">
          {review.resource_name || review.title || 'Untitled'}
        </p>
        <p className="text-xs text-gray-500">
          {review.requested_by_name || 'Unknown'} &middot; {timeAgo}
        </p>
      </div>
      <ChevronRight className="w-4 h-4 text-gray-400 flex-shrink-0" />
    </button>
  );
}

/**
 * Pending approvals widget for dashboard
 * Shows up to 5 pending reviews with a "View all" link
 */
export function PendingApprovalsWidget({ onNavigate, className = '' }) {
  const [reviews, setReviews] = useState([]);
  const [loading, setLoading] = useState(true);
  const [canApprove, setCanApprove] = useState(false);

  useEffect(() => {
    async function loadData() {
      try {
        // Check if user can approve
        const hasPermission = await canApproveContent();
        setCanApprove(hasPermission);

        if (!hasPermission) {
          setLoading(false);
          return;
        }

        // Fetch open reviews (FIFO - oldest first per RESEARCH.md recommendation)
        const data = await fetchOpenReviews({ status: REVIEW_STATUS.OPEN });
        // Sort by oldest first for fairness
        const sorted = (data || []).sort(
          (a, b) => new Date(a.requested_at) - new Date(b.requested_at)
        );
        setReviews(sorted);
      } catch (error) {
        console.error('Error loading pending approvals:', error);
      } finally {
        setLoading(false);
      }
    }

    loadData();
  }, []);

  // Don't render if user can't approve
  if (!canApprove) return null;

  // Don't render if no pending reviews
  if (!loading && reviews.length === 0) return null;

  return (
    <Card className={`p-4 ${className}`}>
      <div className="flex items-center justify-between mb-3">
        <div className="flex items-center gap-2">
          <Clock className="w-5 h-5 text-yellow-600" />
          <h3 className="font-semibold text-gray-900">Pending Approvals</h3>
        </div>
        {reviews.length > 0 && (
          <Badge variant="warning">{reviews.length}</Badge>
        )}
      </div>

      {loading ? (
        <div className="flex items-center justify-center py-6">
          <Loader2 className="w-5 h-5 animate-spin text-gray-400" />
        </div>
      ) : (
        <>
          <div className="space-y-1">
            {reviews.slice(0, 5).map((review) => (
              <ReviewItem key={review.id} review={review} onNavigate={onNavigate} />
            ))}
          </div>

          {reviews.length > 5 && (
            <Button
              variant="link"
              className="w-full mt-3"
              onClick={() => onNavigate('review-inbox')}
            >
              View all {reviews.length} pending
              <ChevronRight className="w-4 h-4 ml-1" />
            </Button>
          )}

          {reviews.length <= 5 && reviews.length > 0 && (
            <Button
              variant="ghost"
              className="w-full mt-3"
              onClick={() => onNavigate('review-inbox')}
            >
              View Review Inbox
              <ChevronRight className="w-4 h-4 ml-1" />
            </Button>
          )}
        </>
      )}
    </Card>
  );
}

export default PendingApprovalsWidget;
```

Create the directory if it doesn't exist: `src/components/dashboard/`
  </action>
  <verify>File exists at src/components/dashboard/PendingApprovalsWidget.jsx with ReviewItem and PendingApprovalsWidget components</verify>
  <done>PendingApprovalsWidget displays pending reviews with navigation to review inbox</done>
</task>

<task type="auto">
  <name>Task 2: Integrate widget into DashboardPage</name>
  <files>src/pages/DashboardPage.jsx</files>
  <action>
Update DashboardPage.jsx to include the PendingApprovalsWidget:

1. Add import near other component imports:
```javascript
import { PendingApprovalsWidget } from '../components/dashboard/PendingApprovalsWidget';
```

2. Find where the dashboard widgets are rendered (likely in the main content area, possibly alongside StatsGrid, AlertsWidget, RecentActivityWidget).

3. Add PendingApprovalsWidget in the dashboard layout, positioned prominently for approvers (suggest placing it after StatsGrid but before other widgets):

```jsx
{/* Pending Approvals Widget - only shows for approvers with pending items */}
<PendingApprovalsWidget onNavigate={setCurrentPage} className="mb-4" />
```

The widget self-hides when:
- User doesn't have approval permissions
- No pending reviews exist

So it can be rendered unconditionally and will only appear when relevant.

Look for the existing layout pattern (likely using Grid or Stack from design-system) and insert the widget appropriately. If using a two-column layout, consider placing it in the right column alongside alerts/activity.
  </action>
  <verify>grep for "PendingApprovalsWidget" import and render in DashboardPage.jsx</verify>
  <done>Dashboard shows pending approvals widget for approvers</done>
</task>

<task type="auto">
  <name>Task 3: Export from DashboardSections if needed</name>
  <files>src/pages/dashboard/DashboardSections.jsx</files>
  <action>
Check if DashboardSections.jsx is used as a central export point for dashboard components.

If yes, add the PendingApprovalsWidget to its exports:

```javascript
// At top of file
export { PendingApprovalsWidget } from '../../components/dashboard/PendingApprovalsWidget';
```

If DashboardSections.jsx doesn't re-export external components (it may only define inline components), skip this step.

The goal is to maintain consistent import patterns across the codebase. If DashboardPage imports directly from component files, that's fine. If it imports from DashboardSections, add the re-export.
  </action>
  <verify>Check import pattern used in DashboardPage and ensure widget is accessible</verify>
  <done>Widget accessible via consistent import pattern</done>
</task>

</tasks>

<verification>
1. PendingApprovalsWidget.jsx exists in src/components/dashboard/
2. DashboardPage imports and renders PendingApprovalsWidget
3. Widget only renders for users with approval permissions
4. Widget shows pending review count and list
5. Clicking review navigates to review inbox
</verification>

<success_criteria>
- Approvers see pending submissions in review queue widget (APR-02)
- Widget shows content name, type, submitter, and time
- Click navigates to ReviewInboxPage
- Non-approvers don't see the widget
- Empty state handled gracefully (widget hidden)
</success_criteria>

<output>
After completion, create `.planning/phases/12-content-approval/12-05-SUMMARY.md`
</output>
