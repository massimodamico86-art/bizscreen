---
phase: 12-content-approval
plan: 08
type: execute
wave: 3
depends_on: ["12-01", "12-05"]
files_modified:
  - src/pages/ReviewInboxPage.jsx
  - supabase/migrations/122_scenes_approval_columns.sql
autonomous: true

must_haves:
  truths:
    - "ReviewInboxPage shows scenes in the review list"
    - "Clicking scene review opens scene editor in read-only mode"
    - "v_review_requests_with_details view includes scene names"
  artifacts:
    - path: "src/pages/ReviewInboxPage.jsx"
      provides: "Scene support in resource icons and navigation"
      contains: "scene.*Film"
    - path: "supabase/migrations/122_scenes_approval_columns.sql"
      provides: "Updated view including scenes"
      contains: "scene.*scenes"
  key_links:
    - from: "src/pages/ReviewInboxPage.jsx"
      to: "SceneEditorPage"
      via: "navigation on scene review click"
      pattern: "scene.*editor"
---

<objective>
Extend ReviewInboxPage to support scene reviews.

Purpose: With scenes now approvable (Plan 01), the review inbox needs to display scene reviews and navigate to the scene editor for preview.

Output: ReviewInboxPage handles scene resource type; view query includes scene names.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/12-content-approval/12-RESEARCH.md
@.planning/phases/12-content-approval/12-01-SUMMARY.md
@.planning/phases/12-content-approval/12-05-SUMMARY.md

# Review inbox
@src/pages/ReviewInboxPage.jsx

# Migration
@supabase/migrations/122_scenes_approval_columns.sql
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add scene to RESOURCE_ICONS in ReviewInboxPage</name>
  <files>src/pages/ReviewInboxPage.jsx</files>
  <action>
Update ReviewInboxPage.jsx to support scenes:

1. Add Film icon import (if not already imported):
```javascript
import {
  // ... existing icons
  Film, // Add this for scene type
} from 'lucide-react';
```

2. Update RESOURCE_ICONS constant to include scene:
```javascript
const RESOURCE_ICONS = {
  playlist: ListVideo,
  layout: Layout,
  campaign: Zap,
  scene: Film, // Add scene
};
```

3. Find where resource type filter options are rendered (likely a dropdown or tabs) and add 'scene' option:
```javascript
// Example: If there's a filter dropdown
const RESOURCE_TYPE_OPTIONS = [
  { value: 'all', label: 'All Types' },
  { value: 'playlist', label: 'Playlists' },
  { value: 'layout', label: 'Layouts' },
  { value: 'campaign', label: 'Campaigns' },
  { value: 'scene', label: 'Scenes' }, // Add scene
];
```
  </action>
  <verify>grep for "scene.*Film" and "scene.*Scenes" in ReviewInboxPage.jsx</verify>
  <done>ReviewInboxPage shows scene icon and filter option</done>
</task>

<task type="auto">
  <name>Task 2: Add scene navigation handler</name>
  <files>src/pages/ReviewInboxPage.jsx</files>
  <action>
Update navigation handler to support opening scene editor:

Find where review items are clicked and content is previewed. Add scene handling:

```javascript
const handleViewResource = (review) => {
  switch (review.resource_type) {
    case 'playlist':
      onNavigate?.(`playlist-editor/${review.resource_id}`);
      break;
    case 'layout':
      onNavigate?.(`layout-editor/${review.resource_id}`);
      break;
    case 'campaign':
      onNavigate?.(`campaign-editor/${review.resource_id}`);
      break;
    case 'scene':
      // Navigate to scene editor with read-only param
      onNavigate?.(`scene-editor/${review.resource_id}?preview=true`);
      break;
    default:
      console.warn('Unknown resource type:', review.resource_type);
  }
};
```

Or if using a different pattern like setCurrentPage:
```javascript
// Construct the page identifier based on resource type
const pageName = `${review.resource_type}-editor`;
setCurrentPage?.(pageName, { id: review.resource_id, preview: true });
```

The exact implementation depends on how navigation works in this page. Look for existing playlist/layout/campaign navigation and add scene following the same pattern.

Note: The `?preview=true` or `preview: true` param is for future enhancement where scene editor shows in read-only mode. For now, just navigate to the editor.
  </action>
  <verify>grep for "scene.*editor" or "scene.*navigate" in ReviewInboxPage.jsx</verify>
  <done>Clicking scene review opens scene editor</done>
</task>

<task type="auto">
  <name>Task 3: Update v_review_requests_with_details view in migration</name>
  <files>supabase/migrations/122_scenes_approval_columns.sql</files>
  <action>
Update migration 122 to recreate the v_review_requests_with_details view with scene support:

Add to the migration file (after the ALTER TABLE statements):

```sql
-- ============================================
-- UPDATE VIEW TO INCLUDE SCENES
-- ============================================

-- Recreate view with scene support
CREATE OR REPLACE VIEW v_review_requests_with_details AS
SELECT
  rr.*,
  CASE rr.resource_type
    WHEN 'playlist' THEN (SELECT name FROM playlists WHERE id = rr.resource_id)
    WHEN 'layout' THEN (SELECT name FROM layouts WHERE id = rr.resource_id)
    WHEN 'campaign' THEN (SELECT name FROM campaigns WHERE id = rr.resource_id)
    WHEN 'scene' THEN (SELECT name FROM scenes WHERE id = rr.resource_id)
  END AS resource_name,
  (SELECT full_name FROM profiles WHERE id = rr.requested_by) AS requested_by_name,
  (SELECT full_name FROM profiles WHERE id = rr.decided_by) AS decided_by_name,
  (SELECT COUNT(*) FROM review_comments WHERE review_id = rr.id) AS comment_count
FROM review_requests rr;

-- Grant select on view
GRANT SELECT ON v_review_requests_with_details TO authenticated;
```

This replaces the existing view definition (from migration 027) with one that includes scene name lookup.

Place this after the existing ALTER TABLE statements in migration 122.
  </action>
  <verify>grep for "scene.*scenes" in the view definition in 122_scenes_approval_columns.sql</verify>
  <done>View includes scene names in resource_name field</done>
</task>

</tasks>

<verification>
1. RESOURCE_ICONS includes scene -> Film mapping
2. Resource type filter includes 'Scenes' option
3. Clicking scene review navigates to scene editor
4. v_review_requests_with_details view includes scene name lookup
</verification>

<success_criteria>
- Scene reviews appear in ReviewInboxPage with correct icon
- Scene type filterable in review list
- Clicking scene review opens scene for preview
- Scene names display correctly (via updated view)
</success_criteria>

<output>
After completion, create `.planning/phases/12-content-approval/12-08-SUMMARY.md`
</output>
