---
phase: 02-xss-prevention
plan: 03
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/pages/HelpCenterPage.jsx
autonomous: true

must_haves:
  truths:
    - "HelpCenterPage renders HTML content through SafeHTML component"
    - "Markdown-like formatting (bold, headers, lists) still renders correctly"
    - "Script tags injected into help content produce no alerts"
  artifacts:
    - path: "src/pages/HelpCenterPage.jsx"
      provides: "Sanitized help content rendering"
      contains: "SafeHTML"
  key_links:
    - from: "src/pages/HelpCenterPage.jsx"
      to: "src/security/SafeHTML.jsx"
      via: "import SafeHTML"
      pattern: "import.*SafeHTML.*from.*security"
---

<objective>
Fix XSS vulnerability in HelpCenterPage by using SafeHTML component for all dangerouslySetInnerHTML usage.

Purpose: HelpCenterPage currently uses dangerouslySetInnerHTML with unsanitized regex-transformed markdown content. This allows XSS if malicious content is stored in help articles. This is requirement SEC-01.

Output: HelpCenterPage uses SafeHTML for all dynamic HTML rendering, blocking XSS while preserving formatting.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-xss-prevention/02-CONTEXT.md
@.planning/phases/02-xss-prevention/02-RESEARCH.md
@.planning/phases/02-xss-prevention/02-01-SUMMARY.md
@src/pages/HelpCenterPage.jsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace dangerouslySetInnerHTML with SafeHTML in HelpCenterPage</name>
  <files>src/pages/HelpCenterPage.jsx</files>
  <action>
    The vulnerable code is in TopicDetailView's renderContent function (lines 269-299):

    **Line 289:**
    ```javascript
    listItems.push(<li key={index} className="text-gray-700" dangerouslySetInnerHTML={{ __html: formatted }} />);
    ```

    **Line 293:**
    ```javascript
    elements.push(<p key={index} className="text-gray-700 mb-3" dangerouslySetInnerHTML={{ __html: formatted }} />);
    ```

    **Fix approach:**

    1. Add import at top of file:
       ```javascript
       import { SafeHTML } from '../security';
       ```

    2. Replace line 289 with:
       ```javascript
       listItems.push(<li key={index} className="text-gray-700"><SafeHTML html={formatted} as="span" /></li>);
       ```
       Note: Use as="span" since we're inside an li element and don't want nested block elements.

    3. Replace line 293 with:
       ```javascript
       elements.push(<SafeHTML key={index} html={formatted} className="text-gray-700 mb-3" as="p" />);
       ```
       Note: Use as="p" to maintain the paragraph semantics.

    **Why this approach:**
    - The `formatted` variable comes from regex replacement: `text.replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>')`
    - This regex could capture malicious content if stored in help articles
    - SafeHTML will preserve the <strong> tags (they're in allowed list) but strip any scripts
    - Using as="span" and as="p" maintains proper HTML semantics

    **Alternative approach (if SafeHTML doesn't support 'as' prop):**
    If the SafeHTML from Plan 01 doesn't have an 'as' prop, wrap differently:
    - For li: `<li key={index} className="text-gray-700"><SafeHTML html={formatted} /></li>` (SafeHTML will render as div, nested in li)
    - For p: Use SafeHTML with className, accept it renders as div instead of p
  </action>
  <verify>
    - `grep -n "dangerouslySetInnerHTML" src/pages/HelpCenterPage.jsx` returns no matches
    - `grep -n "SafeHTML" src/pages/HelpCenterPage.jsx` shows import and usage
    - `grep -n "import.*security" src/pages/HelpCenterPage.jsx` shows import statement
  </verify>
  <done>
    - Zero dangerouslySetInnerHTML usages remain in HelpCenterPage.jsx
    - SafeHTML is imported from '../security'
    - Both list items and paragraphs use SafeHTML for HTML rendering
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify help content rendering still works</name>
  <files>src/pages/HelpCenterPage.jsx</files>
  <action>
    After the fix:

    1. Run ESLint to check for syntax errors:
       `npx eslint src/pages/HelpCenterPage.jsx`

    2. Verify the import path is correct relative to file location:
       - HelpCenterPage is at src/pages/HelpCenterPage.jsx
       - Security module is at src/security/index.js
       - Import should be `from '../security'`

    3. Check that no other dangerouslySetInnerHTML usages exist:
       `grep -rn "dangerouslySetInnerHTML" src/pages/`

    4. If app has dev server, verify help page loads without console errors
  </action>
  <verify>
    - ESLint passes (or only pre-existing warnings)
    - No dangerouslySetInnerHTML in HelpCenterPage.jsx
    - Import path '../security' is correct
  </verify>
  <done>
    - HelpCenterPage.jsx passes linting
    - Help content still renders with proper formatting
    - Bold text (**text**) renders as <strong>
  </done>
</task>

</tasks>

<verification>
1. `grep -c "dangerouslySetInnerHTML" src/pages/HelpCenterPage.jsx` returns 0
2. `grep -c "SafeHTML" src/pages/HelpCenterPage.jsx` returns 3+ (import + usages)
3. ESLint passes without new errors
4. Help page renders formatted content correctly when app runs
</verification>

<success_criteria>
- All dangerouslySetInnerHTML usage in HelpCenterPage replaced with SafeHTML
- Markdown-like formatting (bold) still renders as styled text
- Script injection in help content produces no script execution
- Help page loads without errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-xss-prevention/02-03-SUMMARY.md`
</output>
