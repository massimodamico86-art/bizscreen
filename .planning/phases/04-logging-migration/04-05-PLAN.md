---
phase: 04-logging-migration
plan: 05
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - src/Player.jsx
  - src/TV.jsx
  - src/App.jsx
  - src/supabase.js
  - src/getConfig.js
  - src/config/env.js
  - src/player/cacheService.js
  - src/player/offlineService.js
  - src/auth/AuthCallbackPage.jsx
  - src/i18n/I18nContext.jsx
  - src/contexts/BrandingContext.jsx
  - src/hooks/useFeatureFlag.jsx
  - src/hooks/useLayout.js
  - src/hooks/useLayoutTemplates.js
  - src/hooks/useAdmin.js
  - src/hooks/useCloudinaryUpload.js
  - src/hooks/usePrefetch.js
  - src/hooks/useS3Upload.jsx
  - src/hooks/usePlayerMetrics.js
  - src/hooks/useMediaFolders.js
  - src/hooks/useMedia.js
  - src/hooks/useAuditLogs.js
  - src/hooks/useDataCache.js
  - src/utils/errorTracking.js
  - src/utils/logger.js
  - src/utils/observability.js
  - src/utils/errorMessages.js
  - src/security/sanitize.js
  - src/legacy/utils/performance.js
  - src/components/svg-editor/FabricSvgEditor.jsx
  - src/components/listings/QRCodeManager.jsx
  - src/components/scene-editor/EditorCanvas.jsx
  - src/components/svg-editor/LeftSidebar.jsx
  - src/components/listings/TVDeviceManagement.jsx
  - src/components/layout-editor/PixieEditorModal.jsx
  - src/components/TemplatePickerModal.jsx
  - src/components/SocialFeedWidgetSettings.jsx
  - src/components/scene-editor/DataBoundWizardModal.jsx
  - src/components/OnboardingWizard.jsx
  - src/pages/MediaLibraryPage.jsx
  - src/pages/ScreensPage.jsx
  - src/pages/PlaylistEditorPage.jsx
  - src/pages/DataSourcesPage.jsx
  - src/pages/CampaignEditorPage.jsx
  - src/pages/Admin/AdminEditTemplatePage.jsx
  - src/pages/LayoutEditorPage.jsx
  - src/pages/PlaylistsPage.jsx
  - src/pages/FeatureFlagsPage.jsx
  - src/pages/ServiceQualityPage.jsx
  - src/pages/AppsPage.jsx
  - src/pages/ScreenGroupsPage.jsx
  - src/pages/DeveloperSettingsPage.jsx
  - src/pages/DesignEditorPage.jsx
  - src/pages/ScheduleEditorPage.jsx
autonomous: true

must_haves:
  truths:
    - "Player.jsx and TV.jsx use structured logging for offline debugging"
    - "React components use useLogger hook"
    - "Pages use consistent logging patterns"
    - "Hooks use scoped logger"
  artifacts:
    - path: "src/Player.jsx"
      provides: "Player with structured logging"
      contains: "useLogger"
    - path: "src/TV.jsx"
      provides: "TV display with structured logging"
      contains: "useLogger"
    - path: "src/App.jsx"
      provides: "App root with structured logging"
      contains: "useLogger"
  key_links:
    - from: "src/Player.jsx"
      to: "src/hooks/useLogger.js"
      via: "import useLogger"
      pattern: "import.*useLogger"
    - from: "src/pages/MediaLibraryPage.jsx"
      to: "src/hooks/useLogger.js"
      via: "import useLogger"
      pattern: "import.*useLogger"
---

<objective>
Migrate Player, hooks, components, and pages to structured logging.

Purpose: Complete the frontend migration. Player.jsx is critical for offline debugging. Pages and components round out the migration. This batch covers the highest-call files explicitly, with a sweep task for remaining files.

Output: All React components, pages, hooks, and utility files use structured logging.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-logging-migration/04-RESEARCH.md
@.planning/phases/04-logging-migration/04-01-SUMMARY.md
@src/hooks/useLogger.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate Player, TV, App, and core files</name>
  <files>
    src/Player.jsx
    src/TV.jsx
    src/App.jsx
    src/supabase.js
    src/getConfig.js
    src/config/env.js
    src/player/cacheService.js
    src/player/offlineService.js
    src/auth/AuthCallbackPage.jsx
    src/i18n/I18nContext.jsx
    src/contexts/BrandingContext.jsx
  </files>
  <action>
Migrate core application files (~90 console calls):

1. For Player.jsx (47 calls - largest single file):
   - Add: `import { useLogger } from './hooks/useLogger.js';`
   - Add in component: `const logger = useLogger('Player');`
   - Transform all console calls:
     - Startup: logger.info('Player initialized', { screenId })
     - Content load: logger.debug('Loading content', { contentId })
     - Playback events: logger.debug('Content playing', { contentId, duration })
     - Offline switch: logger.warn('Switching to offline mode')
     - Errors: logger.error('Playback error', { error, contentId })
   - This component runs on player devices - logging is critical for debugging

2. For TV.jsx (6 calls):
   - Use useLogger hook
   - Display events: logger.info('Display mode changed', { mode })

3. For App.jsx (10 calls):
   - Use useLogger hook
   - App lifecycle: logger.info('App mounted')
   - Route changes: logger.debug if needed, or remove

4. For supabase.js (7 calls):
   - Use createScopedLogger (not useLogger - not a React component)
   - Connection events: logger.info/warn/error as appropriate

5. For config/env.js (5 calls):
   - These are validation/init logs - can use createScopedLogger
   - Or remove if truly one-time and not valuable

6. For player/ directory (cacheService, offlineService - 40 calls):
   - Use createScopedLogger (not React components)
   - Cache operations: logger.debug
   - Sync events: logger.info
   - Errors: logger.error

7. For contexts (BrandingContext, I18nContext):
   - Use useLogger hook inside Provider component

8. For auth/AuthCallbackPage.jsx:
   - Use useLogger hook
  </action>
  <verify>
1. `grep -c "console\." src/Player.jsx` returns 0
2. `grep -c "console\." src/TV.jsx` returns 0
3. `grep -c "console\." src/App.jsx` returns 0
4. `npm run build` succeeds
  </verify>
  <done>Core application files (11 files, ~90 calls) migrated to structured logging</done>
</task>

<task type="auto">
  <name>Task 2: Migrate hooks and utility files</name>
  <files>
    src/hooks/useFeatureFlag.jsx
    src/hooks/useLayout.js
    src/hooks/useLayoutTemplates.js
    src/hooks/useAdmin.js
    src/hooks/useCloudinaryUpload.js
    src/hooks/usePrefetch.js
    src/hooks/useS3Upload.jsx
    src/hooks/usePlayerMetrics.js
    src/hooks/useMediaFolders.js
    src/hooks/useMedia.js
    src/hooks/useAuditLogs.js
    src/hooks/useDataCache.js
    src/utils/errorTracking.js
    src/utils/logger.js
    src/utils/observability.js
    src/utils/errorMessages.js
    src/security/sanitize.js
    src/legacy/utils/performance.js
  </files>
  <action>
Migrate hooks and utilities (~55 console calls):

1. For hooks (12 files, 44 calls):
   - Hooks can use createScopedLogger (simpler than useLogger for non-rendering code)
   - Add at top: `import { createScopedLogger } from '../services/loggingService.js';`
   - Create logger: `const logger = createScopedLogger('useHookName');`

   - useMediaFolders (12 calls): Most verbose hook
     - Folder operations: logger.debug
     - Errors: logger.error

   - useMedia (7 calls): Media operations
     - Load/save: logger.debug
     - Errors: logger.error

   - useCloudinaryUpload (6 calls): Upload hook
     - Upload progress: logger.debug
     - Errors: logger.error

   - Other hooks: Apply same pattern

2. For utils/errorTracking.js (10 calls):
   - This is special - it initializes Sentry
   - Keep minimal console.warn for Sentry init failures (fallback when logging itself fails)
   - Other logs can use structured logger
   - Be careful not to create circular dependency with loggingService

3. For utils/logger.js (4 calls):
   - This is the OLD logger being deprecated
   - Mark with TODO comment for removal in Plan 06
   - Don't migrate - we're replacing it

4. For security/sanitize.js (1 call):
   - Use createScopedLogger

5. For legacy/utils/performance.js (2 calls):
   - Use createScopedLogger
  </action>
  <verify>
1. `grep -r "console\." src/hooks/*.js src/hooks/*.jsx | wc -l` returns 0 or near-zero
2. `npm run build` succeeds
  </verify>
  <done>Hooks and utilities (18 files, ~55 calls) migrated to structured logging</done>
</task>

<task type="auto">
  <name>Task 3a: Migrate high-call components (10+ calls)</name>
  <files>
    src/components/svg-editor/FabricSvgEditor.jsx
    src/components/listings/QRCodeManager.jsx
  </files>
  <action>
Migrate the two highest-call components (~40 calls total):

1. For FabricSvgEditor.jsx (31 calls - highest component):
   - Add: `import { useLogger } from '../../hooks/useLogger.js';`
   - Add in component: `const logger = useLogger('FabricSvgEditor');`
   - Transform calls:
     - JSON/SVG loading: logger.debug('Loading from saved JSON...')
     - Canvas operations: logger.debug('SVG loaded:', { objectCount, dimensions })
     - Template operations: logger.info('Saving template', { name })
     - Errors: logger.error('Failed to load content', { error })
   - Many of these are development logs - consider removing pure debug logs

2. For QRCodeManager.jsx (9 calls):
   - Use useLogger hook
   - CRUD operations: logger.info for create/update/delete
   - Errors: logger.error('Error generating QR code', { error })
  </action>
  <verify>
1. `grep -c "console\." src/components/svg-editor/FabricSvgEditor.jsx` returns 0
2. `grep -c "console\." src/components/listings/QRCodeManager.jsx` returns 0
3. `npm run build` succeeds
  </verify>
  <done>High-call components (2 files, ~40 calls) migrated to structured logging</done>
</task>

<task type="auto">
  <name>Task 3b: Migrate medium-call components (3-9 calls)</name>
  <files>
    src/components/scene-editor/EditorCanvas.jsx
    src/components/svg-editor/LeftSidebar.jsx
    src/components/listings/TVDeviceManagement.jsx
    src/components/layout-editor/PixieEditorModal.jsx
    src/components/TemplatePickerModal.jsx
    src/components/SocialFeedWidgetSettings.jsx
    src/components/scene-editor/DataBoundWizardModal.jsx
    src/components/OnboardingWizard.jsx
  </files>
  <action>
Migrate medium-call components (~35 calls total):

1. For each file:
   - Add: `import { useLogger } from '../../hooks/useLogger.js';` (adjust path)
   - Add in component: `const logger = useLogger('ComponentName');`

2. Specific guidance:
   - EditorCanvas.jsx (5 calls): Data binding logs -> logger.debug
   - LeftSidebar.jsx (5 calls): Photo/GIPHY/template fetch -> logger.debug
   - TVDeviceManagement.jsx (6 calls): Device operations -> logger.info for changes, error for failures
   - PixieEditorModal.jsx (4 calls): Editor operations -> logger.debug
   - TemplatePickerModal.jsx (3 calls): Template loading -> logger.debug
   - SocialFeedWidgetSettings.jsx (3 calls): Settings operations -> logger.debug
   - DataBoundWizardModal.jsx (3 calls): Wizard operations -> logger.debug
   - OnboardingWizard.jsx (3 calls): Onboarding progress -> logger.info

3. Log level guidelines for UI code:
   - User actions: logger.info('Action completed', { action })
   - Data loading: logger.debug('Loading data')
   - Errors: logger.error('Operation failed', { error })
  </action>
  <verify>
1. `grep -c "console\." src/components/scene-editor/EditorCanvas.jsx` returns 0
2. `grep -c "console\." src/components/svg-editor/LeftSidebar.jsx` returns 0
3. Same for all 8 files
4. `npm run build` succeeds
  </verify>
  <done>Medium-call components (8 files, ~35 calls) migrated to structured logging</done>
</task>

<task type="auto">
  <name>Task 3c: Migrate high-call pages (10+ calls)</name>
  <files>
    src/pages/MediaLibraryPage.jsx
    src/pages/ScreensPage.jsx
    src/pages/PlaylistEditorPage.jsx
    src/pages/DataSourcesPage.jsx
    src/pages/CampaignEditorPage.jsx
    src/pages/Admin/AdminEditTemplatePage.jsx
    src/pages/LayoutEditorPage.jsx
    src/pages/PlaylistsPage.jsx
    src/pages/FeatureFlagsPage.jsx
  </files>
  <action>
Migrate high-call pages (~141 calls total):

1. For each file:
   - Add: `import { useLogger } from '../hooks/useLogger.js';` (adjust path for Admin/)
   - Add in component: `const logger = useLogger('PageName');`

2. Specific guidance:
   - MediaLibraryPage.jsx (23 calls): Media operations -> logger.debug for loads, logger.info for uploads
   - ScreensPage.jsx (20 calls): Screen operations -> logger.info for changes
   - PlaylistEditorPage.jsx (18 calls): Playlist editing -> logger.debug
   - DataSourcesPage.jsx (16 calls): Data source operations -> logger.debug
   - CampaignEditorPage.jsx (16 calls): Campaign editing -> logger.debug
   - AdminEditTemplatePage.jsx (14 calls): Template editing -> logger.debug, logger.info for saves
   - LayoutEditorPage.jsx (12 calls): Layout editing -> logger.debug
   - PlaylistsPage.jsx (12 calls): Playlist listing -> logger.debug
   - FeatureFlagsPage.jsx (12 calls): Flag operations -> logger.info for changes

3. Many page logs are development debugging - consider removing non-essential ones.
  </action>
  <verify>
1. `grep -c "console\." src/pages/MediaLibraryPage.jsx` returns 0
2. `grep -c "console\." src/pages/ScreensPage.jsx` returns 0
3. Same for all 9 files
4. `npm run build` succeeds
  </verify>
  <done>High-call pages (9 files, ~141 calls) migrated to structured logging</done>
</task>

<task type="auto">
  <name>Task 3d: Migrate medium-call pages (5-9 calls)</name>
  <files>
    src/pages/ServiceQualityPage.jsx
    src/pages/AppsPage.jsx
    src/pages/ScreenGroupsPage.jsx
    src/pages/DeveloperSettingsPage.jsx
    src/pages/DesignEditorPage.jsx
    src/pages/ScheduleEditorPage.jsx
    src/pages/WhiteLabelSettingsPage.jsx
    src/pages/SocialAccountsPage.jsx
    src/pages/SvgEditorPage.jsx
    src/pages/SchedulesPage.jsx
  </files>
  <action>
Migrate medium-call pages (~73 calls total):

1. For each file:
   - Add: `import { useLogger } from '../hooks/useLogger.js';`
   - Add in component: `const logger = useLogger('PageName');`

2. Apply standard log level mapping:
   - Success operations: logger.info
   - Routine operations: logger.debug
   - Recoverable issues: logger.warn
   - Failures: logger.error
  </action>
  <verify>
1. For each file: `grep -c "console\." src/pages/[PageName].jsx` returns 0
2. `npm run build` succeeds
  </verify>
  <done>Medium-call pages (10 files, ~73 calls) migrated to structured logging</done>
</task>

<task type="auto">
  <name>Task 3e: Sweep remaining components and pages</name>
  <files>
    All remaining files in src/components/**/*.jsx and src/pages/**/*.jsx
  </files>
  <action>
Complete migration of all remaining components and pages with 1-4 console calls each:

1. Run sweep to find remaining files:
   ```bash
   grep -rl "console\." src/components --include="*.jsx" | head -30
   grep -rl "console\." src/pages --include="*.jsx" | head -30
   ```

2. For each file found:
   - Add useLogger import
   - Transform console calls following established patterns
   - Most files have 1-3 calls - quick migrations

3. Remaining components (~36 calls across ~29 files):
   - Apply same pattern: useLogger, appropriate log levels

4. Remaining pages (~97 calls across ~35 files):
   - Apply same pattern: useLogger, appropriate log levels

5. After completing all files, verify sweep is complete:
   ```bash
   grep -r "console\." src/components --include="*.jsx" | grep -v node_modules | wc -l
   grep -r "console\." src/pages --include="*.jsx" | grep -v node_modules | wc -l
   ```
   Both should return 0.
  </action>
  <verify>
1. `grep -r "console\." src/components --include="*.jsx" | wc -l` returns 0
2. `grep -r "console\." src/pages --include="*.jsx" | wc -l` returns 0
3. `npm run build` succeeds
4. `npm run lint` shows fewer warnings than before
  </verify>
  <done>All remaining components and pages migrated - zero console calls in src/components and src/pages</done>
</task>

</tasks>

<verification>
1. Total console calls in src/ (excluding services, which Plan 03+04 cover):
   `grep -r "console\." src/*.jsx src/*.js src/hooks src/components src/pages src/contexts src/player src/auth src/config src/utils src/security src/legacy src/i18n 2>/dev/null | grep -v node_modules | grep -v loggingService | wc -l`
   Should be 0 or near-zero

2. All React components import useLogger
3. All non-React files import createScopedLogger
4. `npm run build` succeeds
5. `npm run lint` shows dramatically fewer no-console warnings
</verification>

<success_criteria>
- Player.jsx, TV.jsx, App.jsx use structured logging
- All 12 hooks migrated
- All ~39 components migrated (verified: 0 console calls in src/components)
- All ~54 pages migrated (verified: 0 console calls in src/pages)
- All utility files migrated
- Build passes
</success_criteria>

<output>
After completion, create `.planning/phases/04-logging-migration/04-05-SUMMARY.md`
</output>
