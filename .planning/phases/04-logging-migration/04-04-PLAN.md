---
phase: 04-logging-migration
plan: 04
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - src/services/realtimeService.js
  - src/services/notificationDispatcherService.js
  - src/services/dataSourceService.js
  - src/services/alertEngineService.js
  - src/services/socialFeedSyncService.js
  - src/services/weatherService.js
  - src/services/screenshotService.js
  - src/services/dataFeedScheduler.js
  - src/services/locationService.js
  - src/services/feedbackService.js
  - src/services/featureFlagService.js
  - src/services/clientService.js
  - src/services/svgTemplateService.js
  - src/services/experimentService.js
  - src/services/metricsService.js
  - src/services/activityLogService.js
  - src/services/slaService.js
  - src/services/demoService.js
  - src/services/onboardingService.js
  - src/services/helpService.js
  - src/services/brandThemeService.js
  - src/services/brandingService.js
  - src/services/usageService.js
  - src/services/googleSheetsService.js
  - src/services/webVitalsService.js
  - src/services/errorTrackingService.js
  - src/services/dashboardService.js
  - src/services/userSettingsService.js
  - src/services/consentService.js
  - src/services/limitsService.js
autonomous: true

must_haves:
  truths:
    - "All remaining service files use structured logging"
    - "High-volume services (realtime, notifications) use appropriate log levels"
    - "External API services (weather, social) log failures at warn/error level"
  artifacts:
    - path: "src/services/realtimeService.js"
      provides: "Realtime operations with structured logging"
      contains: "createScopedLogger"
    - path: "src/services/notificationDispatcherService.js"
      provides: "Notification dispatch with structured logging"
      contains: "createScopedLogger"
  key_links:
    - from: "src/services/realtimeService.js"
      to: "src/services/loggingService.js"
      via: "import createScopedLogger"
      pattern: "import.*loggingService"
---

<objective>
Migrate remaining service files to structured logging.

Purpose: Complete the services migration. This batch covers utility services, external integrations, and feature services. Runs in parallel with Plan 03 since both depend only on Plan 01.

Output: All 67 service files use structured logging (51 files in this plan + 16 from Plan 03).
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-logging-migration/04-RESEARCH.md
@.planning/phases/04-logging-migration/04-01-SUMMARY.md
@src/services/loggingService.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate high-volume and realtime services</name>
  <files>
    src/services/realtimeService.js
    src/services/notificationDispatcherService.js
    src/services/dataSourceService.js
    src/services/alertEngineService.js
    src/services/dataFeedScheduler.js
  </files>
  <action>
These services have the highest console call counts (~120 total). Handle carefully:

1. Add import and scoped logger to each file:
   ```js
   import { createScopedLogger } from './loggingService.js';
   const logger = createScopedLogger('ServiceName');
   ```

2. For realtimeService.js (25 calls):
   - Connection events: logger.info('Connected', { channel })
   - Reconnection: logger.warn('Reconnecting', { attempt, delay })
   - Subscription: logger.debug('Subscribed', { channel }) // high volume
   - Errors: logger.error('Connection failed', { error })

3. For notificationDispatcherService.js (29 calls):
   - Dispatch success: logger.info('Notification sent', { type, recipientCount })
   - Batch operations: logger.debug('Processing batch', { size })
   - Failures: logger.error('Dispatch failed', { error, notificationId })

4. For dataSourceService.js (30 calls):
   - Data fetch: logger.debug('Fetching data', { sourceId })
   - Cache operations: logger.debug('Cache hit/miss', { sourceId })
   - Errors: logger.error('Data fetch failed', { sourceId, error })

5. For alertEngineService.js (22 calls):
   - Alert triggered: logger.info('Alert triggered', { alertId, condition })
   - Evaluation: logger.debug('Evaluating conditions', { ruleCount })

6. For dataFeedScheduler.js (15 calls):
   - Scheduled run: logger.debug('Feed scheduled', { feedId, nextRun })
   - Execution: logger.info('Feed executed', { feedId, recordCount })

Use logger.debug liberally for high-frequency operations to avoid log volume issues.
  </action>
  <verify>
1. `grep -c "console\." src/services/realtimeService.js` returns 0
2. `grep -c "console\." src/services/notificationDispatcherService.js` returns 0
3. Same for all 5 files
4. `npm run build` succeeds
  </verify>
  <done>High-volume services (5 files, ~120 calls) migrated to structured logging</done>
</task>

<task type="auto">
  <name>Task 2: Migrate external integration services</name>
  <files>
    src/services/socialFeedSyncService.js
    src/services/weatherService.js
    src/services/googleSheetsService.js
    src/services/social/facebookService.js
    src/services/social/instagramService.js
    src/services/social/tiktokService.js
    src/services/social/googleReviewsService.js
    src/services/cloudinaryService.js
    src/services/s3UploadService.js
    src/services/mediaPreloader.js
  </files>
  <action>
External API integrations (~60 calls):

1. Add scoped logger to each file.

2. For social services (socialFeedSyncService, facebook, instagram, tiktok, googleReviews):
   - API calls: logger.debug('Fetching feed', { accountId })
   - Success: logger.info('Feed synced', { accountId, postCount })
   - Rate limits: logger.warn('Rate limited', { service, retryAfter })
   - Auth failures: logger.error('Auth failed', { service, error })

3. For weatherService.js (15 calls):
   - Weather fetch: logger.debug('Fetching weather', { location })
   - Cache: logger.debug('Weather cache', { hit: true/false })
   - API errors: logger.warn('Weather API error', { error }) // warn, not error - non-critical

4. For upload services (cloudinary, s3Upload, mediaPreloader):
   - Upload start: logger.info('Upload started', { filename, size })
   - Progress: logger.debug('Upload progress', { percent }) // if logged
   - Complete: logger.info('Upload complete', { filename, url })
   - Failure: logger.error('Upload failed', { filename, error })

5. For googleSheetsService.js (7 calls):
   - Sheet access: logger.debug('Reading sheet', { sheetId })
   - Write: logger.info('Sheet updated', { sheetId, rows })
  </action>
  <verify>
1. `grep -c "console\." src/services/weatherService.js` returns 0
2. `grep -c "console\." src/services/socialFeedSyncService.js` returns 0
3. Same for all 10 files
4. `npm run build` succeeds
  </verify>
  <done>External integration services (10 files) migrated to structured logging</done>
</task>

<task type="auto">
  <name>Task 3: Migrate remaining utility services</name>
  <files>
    src/services/screenshotService.js
    src/services/locationService.js
    src/services/feedbackService.js
    src/services/featureFlagService.js
    src/services/clientService.js
    src/services/svgTemplateService.js
    src/services/experimentService.js
    src/services/metricsService.js
    src/services/activityLogService.js
    src/services/slaService.js
    src/services/demoService.js
    src/services/onboardingService.js
    src/services/helpService.js
    src/services/brandThemeService.js
    src/services/brandingService.js
    src/services/usageService.js
    src/services/webVitalsService.js
    src/services/errorTrackingService.js
    src/services/dashboardService.js
    src/services/userSettingsService.js
    src/services/consentService.js
    src/services/limitsService.js
    src/services/complianceService.js
    src/services/apiVersionService.js
    src/services/apiTokenService.js
    src/services/accountPlanService.js
    src/services/qrcodeService.js
    src/services/geolocationService.js
    src/services/brandAiService.js
    src/services/demoContentService.js
    src/services/templateService.js
    src/services/autoTaggingService.js
    src/services/dataBindingResolver.js
  </files>
  <action>
Complete the services migration (~120 calls across 33 files):

1. Add scoped logger to each file using consistent pattern.

2. Apply standard log level mapping:
   - Success operations: logger.info
   - Routine operations: logger.debug
   - Recoverable issues: logger.warn
   - Failures: logger.error

3. Special cases:
   - errorTrackingService.js: Be careful not to create logging loops
     - Keep the internal console.warn for Sentry init failures
     - Other logging can use structured logger

   - webVitalsService.js: Performance metrics
     - Use logger.debug for metrics reporting

   - featureFlagService.js: High volume
     - Flag checks: logger.debug (or remove - very high volume)
     - Flag changes: logger.info

   - activityLogService.js: Already a logging service
     - Use sparingly - mainly for service errors

   - metricsService.js: Analytics
     - Use logger.debug for metric collection

4. For very small services (1-3 calls), ensure consistent pattern even if simple.

Note: Skip src/services/loggingService.js itself (it's the logger).
Note: Skip src/utils/logger.js (deprecated, handled in Plan 06).
  </action>
  <verify>
1. Count remaining console calls in services:
   `grep -r "console\." src/services/*.js | grep -v loggingService | grep -v "node_modules" | wc -l`
   Should be 0 (or very close - loggingService.js may have internal ones)
2. `npm run build` succeeds
  </verify>
  <done>All utility services (33 files) migrated to structured logging</done>
</task>

</tasks>

<verification>
1. Total console calls in services directory (excluding loggingService):
   `grep -r "console\." src/services/*.js src/services/**/*.js | grep -v loggingService.js | wc -l`
   Should be 0 or near-zero
2. All service files import createScopedLogger
3. `npm run build` succeeds
4. `npm run lint` shows fewer warnings than before
</verification>

<success_criteria>
- All 51 service files in this plan migrated to structured logging
- Combined with Plan 03, all ~67 service files are migrated
- Zero console.log calls in services (except internal logger calls in loggingService.js)
- Appropriate log levels used based on operation type
- Build passes
</success_criteria>

<output>
After completion, create `.planning/phases/04-logging-migration/04-04-SUMMARY.md`
</output>
