---
phase: 08-page-refactoring
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/pages/hooks/index.js
  - src/pages/hooks/useCampaignEditor.js
  - src/pages/CampaignEditorPage.jsx
autonomous: true

must_haves:
  truths:
    - "CampaignEditorPage loads existing campaign data when editing"
    - "Campaign form saves and updates correctly"
    - "Targets can be added and removed"
    - "Content can be added and removed"
    - "Approval workflow functions (submit, revert)"
    - "Preview links can be created and revoked"
  artifacts:
    - path: "src/pages/hooks/useCampaignEditor.js"
      provides: "Campaign data state, picker data, form handling, approval/preview state"
      min_lines: 200
    - path: "src/pages/CampaignEditorPage.jsx"
      provides: "Refactored page using useCampaignEditor hook"
      max_lines: 600
  key_links:
    - from: "src/pages/CampaignEditorPage.jsx"
      to: "src/pages/hooks/useCampaignEditor.js"
      via: "import { useCampaignEditor }"
      pattern: "useCampaignEditor"
    - from: "src/pages/hooks/useCampaignEditor.js"
      to: "services/campaignService"
      via: "getCampaign, createCampaign, updateCampaign"
      pattern: "campaignService"
---

<objective>
Extract custom hook from CampaignEditorPage.jsx to reduce complexity.

Purpose: CampaignEditorPage (1392 lines) has medium complexity with campaign state, picker data, approval workflow, and preview links. Extracting to useCampaignEditor isolates form logic.

Output: useCampaignEditor.js hook, updated barrel export, refactored page under ~500 lines.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-page-refactoring/08-RESEARCH.md

# Reference patterns
@src/player/hooks/usePlayerContent.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useCampaignEditor hook</name>
  <files>
    - src/pages/hooks/useCampaignEditor.js
    - src/pages/hooks/index.js
  </files>
  <action>
Create useCampaignEditor.js hook that extracts from CampaignEditorPage.jsx:

**Campaign state:**
- campaign object (name, description, status, start_at, end_at, priority, targets, contents)
- loading, saving, hasChanges booleans

**Picker data:**
- screens, screenGroups, locations, playlists, layouts arrays
- showTargetPicker, showContentPicker modal states

**Approval/Preview state:**
- showApprovalModal, approvalMessage, submittingApproval, currentReview
- showPreviewModal, previewLinks, loadingPreviewLinks, creatingPreviewLink
- selectedExpiry, allowComments, copiedLinkId

**Actions:**
- loadCampaign(campaignId)
- loadPickerData()
- handleChange(field, value)
- handleSave(navigate, showToast)
- handleDelete(navigate, showToast)
- handleActivate/handlePause
- handleAddTarget, handleRemoveTarget
- handleAddContent, handleRemoveContent
- Approval: handleSubmitForApproval, handleRevertToDraft
- Preview: loadPreviewLinks, handleCreatePreviewLink, handleRevokePreviewLink, handleCopyLink

Hook signature:
```javascript
export function useCampaignEditor(campaignId, { showToast }) {
  // Takes campaignId from route and showToast callback
  const isNew = campaignId === 'new';

  return {
    // Campaign state
    campaign, setCampaign,
    loading, saving, hasChanges, isNew,
    // Picker data
    screens, screenGroups, locations, playlists, layouts,
    showTargetPicker, setShowTargetPicker,
    showContentPicker, setShowContentPicker,
    // Approval state
    showApprovalModal, setShowApprovalModal,
    approvalMessage, setApprovalMessage,
    submittingApproval, currentReview,
    // Preview state
    showPreviewModal, setShowPreviewModal,
    previewLinks, loadingPreviewLinks, creatingPreviewLink,
    selectedExpiry, setSelectedExpiry,
    allowComments, setAllowComments,
    copiedLinkId,
    // Actions
    handleChange, handleSave, handleDelete,
    handleActivate, handlePause,
    handleAddTarget, handleRemoveTarget,
    handleAddContent, handleRemoveContent,
    handleSubmitForApproval, handleRevertToDraft,
    loadPreviewLinks, handleCreatePreviewLink, handleRevokePreviewLink, handleCopyLink,
  };
}
```

Use createScopedLogger('useCampaignEditor') for logging.

Update index.js to add export:
```javascript
export { useCampaignEditor } from './useCampaignEditor.js';
```
  </action>
  <verify>
    - src/pages/hooks/useCampaignEditor.js exports useCampaignEditor function
    - Hook imports required services (campaignService, approvalService, previewService)
    - index.js exports useCampaignEditor
  </verify>
  <done>
    - useCampaignEditor hook created with campaign state, picker data, approval/preview logic
    - Barrel export updated
  </done>
</task>

<task type="auto">
  <name>Task 2: Refactor CampaignEditorPage to use useCampaignEditor hook</name>
  <files>
    - src/pages/CampaignEditorPage.jsx
  </files>
  <action>
Update CampaignEditorPage.jsx to use the new useCampaignEditor hook:

1. Import hook: `import { useCampaignEditor } from './hooks';`

2. Get campaignId from params: `const { campaignId } = useParams();`

3. Call hook with campaignId:
```javascript
const {
  campaign, setCampaign, loading, saving, hasChanges, isNew,
  screens, screenGroups, locations, playlists, layouts,
  showTargetPicker, setShowTargetPicker,
  showContentPicker, setShowContentPicker,
  showApprovalModal, setShowApprovalModal,
  approvalMessage, setApprovalMessage,
  submittingApproval, currentReview,
  showPreviewModal, setShowPreviewModal,
  previewLinks, loadingPreviewLinks, creatingPreviewLink,
  selectedExpiry, setSelectedExpiry,
  allowComments, setAllowComments,
  copiedLinkId,
  handleChange, handleSave, handleDelete,
  handleActivate, handlePause,
  handleAddTarget, handleRemoveTarget,
  handleAddContent, handleRemoveContent,
  handleSubmitForApproval, handleRevertToDraft,
  loadPreviewLinks, handleCreatePreviewLink, handleRevokePreviewLink, handleCopyLink,
} = useCampaignEditor(campaignId, { showToast });
```

4. Remove all state declarations that moved to hook
5. Remove loadCampaign, loadPickerData functions and useEffects
6. Remove handler functions that are now in hook
7. Keep JSX rendering, form UI, target/content pickers, modals

Page retains:
- Permission check (canEdit)
- Navigation (useNavigate)
- Translation (useTranslation)
- Form UI rendering
- Target/Content picker modals
- Approval modal
- Preview modal

Target: Under 600 lines.
  </action>
  <verify>
    - `npm run lint src/pages/CampaignEditorPage.jsx` passes
    - Page file is under 600 lines: `wc -l src/pages/CampaignEditorPage.jsx`
  </verify>
  <done>
    - CampaignEditorPage.jsx uses useCampaignEditor hook
    - Page reduced from 1392 lines to under 600 lines
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify page functionality</name>
  <files>None (verification only)</files>
  <action>
1. Run lint check:
```bash
npm run lint src/pages/CampaignEditorPage.jsx src/pages/hooks/useCampaignEditor.js
```

2. Run tests:
```bash
npm test -- --run
```

3. Verify line counts:
```bash
wc -l src/pages/CampaignEditorPage.jsx src/pages/hooks/useCampaignEditor.js
```

Fix any issues before completing.
  </action>
  <verify>
    - Lint passes for modified files
    - Existing test suite passes (allow pre-existing failures)
    - Line count targets met
  </verify>
  <done>
    - All linting passes
    - No new test regressions
  </done>
</task>

</tasks>

<verification>
1. Hook created: `ls src/pages/hooks/useCampaignEditor.js`
2. Barrel export updated: `grep "useCampaignEditor" src/pages/hooks/index.js`
3. Page imports hook: `grep "useCampaignEditor" src/pages/CampaignEditorPage.jsx`
4. Line reduction: `wc -l src/pages/CampaignEditorPage.jsx` shows under 600 lines
5. Lint passes: `npm run lint src/pages/CampaignEditorPage.jsx`
</verification>

<success_criteria>
- useCampaignEditor.js hook extracts campaign state, picker data, approval/preview logic
- CampaignEditorPage.jsx reduced from 1392 to under 600 lines
- All existing functionality preserved (form, targets, content, approval, preview)
- Lint and existing tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/08-page-refactoring/08-02-SUMMARY.md`
</output>
