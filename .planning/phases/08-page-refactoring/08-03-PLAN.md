---
phase: 08-page-refactoring
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/pages/hooks/index.js
  - src/pages/hooks/usePlaylistEditor.js
  - src/pages/PlaylistEditorPage.jsx
autonomous: true

must_haves:
  truths:
    - "PlaylistEditorPage loads existing playlist data when editing"
    - "Media items can be added from library picker"
    - "Playlist items can be reordered via drag-drop"
    - "Item durations can be adjusted"
    - "AI slide generation works"
    - "Save as template works"
    - "Approval workflow functions"
  artifacts:
    - path: "src/pages/hooks/usePlaylistEditor.js"
      provides: "Playlist data state, media library, drag-drop state, approval/preview"
      min_lines: 250
    - path: "src/pages/PlaylistEditorPage.jsx"
      provides: "Refactored page using usePlaylistEditor hook"
      max_lines: 700
  key_links:
    - from: "src/pages/PlaylistEditorPage.jsx"
      to: "src/pages/hooks/usePlaylistEditor.js"
      via: "import { usePlaylistEditor }"
      pattern: "usePlaylistEditor"
    - from: "src/pages/hooks/usePlaylistEditor.js"
      to: "supabase"
      via: "playlist data fetching"
      pattern: "supabase"
---

<objective>
Extract custom hook from PlaylistEditorPage.jsx to reduce complexity.

Purpose: PlaylistEditorPage (1917 lines) has medium-high complexity with playlist state, media library, drag-drop reordering, AI generation, and approval/preview. Extracting to usePlaylistEditor isolates business logic.

Output: usePlaylistEditor.js hook, updated barrel export, refactored page under ~600 lines.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-page-refactoring/08-RESEARCH.md

# Reference patterns
@src/player/hooks/usePlayerContent.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create usePlaylistEditor hook</name>
  <files>
    - src/pages/hooks/usePlaylistEditor.js
    - src/pages/hooks/index.js
  </files>
  <action>
Create usePlaylistEditor.js hook that extracts from PlaylistEditorPage.jsx:

**Playlist state:**
- playlist object (name, description, status, items)
- loading, saving, hasChanges booleans

**Media library state:**
- mediaAssets, mediaFolders arrays
- currentFolderId, folderPath
- search, filter, isLoadingMedia

**Drag-drop state:**
- dragIndex, dropIndex (for reordering)

**Approval/Preview state (same pattern as CampaignEditor):**
- showApprovalModal, approvalMessage, submittingApproval, currentReview
- showPreviewModal, previewLinks, etc.

**AI generation state:**
- showAIModal, aiPrompt, generatingSlides

**Actions:**
- loadPlaylist(playlistId)
- loadMediaAssets()
- handleAddItem(mediaAsset)
- handleRemoveItem(itemId)
- handleReorderItems(fromIndex, toIndex)
- handleUpdateDuration(itemId, duration)
- handleSave(navigate, showToast)
- handleDelete(navigate, showToast)
- Drag handlers: handleDragStart, handleDragOver, handleDrop, handleDragEnd
- AI: handleGenerateSlides, handleMaterialize
- Approval: handleSubmitForApproval, handleRevertToDraft
- Preview: loadPreviewLinks, handleCreatePreviewLink, etc.
- Template: handleSaveAsTemplate

Hook signature:
```javascript
export function usePlaylistEditor(playlistId, { showToast }) {
  const isNew = !playlistId || playlistId === 'new';

  return {
    // Playlist state
    playlist, setPlaylist, loading, saving, hasChanges, isNew,
    // Media library
    mediaAssets, mediaFolders, currentFolderId, setCurrentFolderId,
    folderPath, search, setSearch, filter, setFilter, isLoadingMedia,
    // Drag-drop
    dragIndex, dropIndex,
    // Approval/preview
    showApprovalModal, setShowApprovalModal,
    // ... (similar to campaign editor)
    // AI
    showAIModal, setShowAIModal, aiPrompt, setAiPrompt, generatingSlides,
    // Actions
    handleAddItem, handleRemoveItem, handleReorderItems, handleUpdateDuration,
    handleSave, handleDelete,
    handleDragStart, handleDragOver, handleDrop, handleDragEnd,
    handleGenerateSlides, handleMaterialize,
    handleSubmitForApproval, handleRevertToDraft,
    handleSaveAsTemplate,
    // ... preview actions
  };
}
```

Use createScopedLogger('usePlaylistEditor') for logging.

Update index.js:
```javascript
export { usePlaylistEditor } from './usePlaylistEditor.js';
```
  </action>
  <verify>
    - src/pages/hooks/usePlaylistEditor.js exports usePlaylistEditor function
    - Hook handles playlist state, media library, drag-drop, AI, approval
    - index.js exports usePlaylistEditor
  </verify>
  <done>
    - usePlaylistEditor hook created with all playlist editor logic
    - Barrel export updated
  </done>
</task>

<task type="auto">
  <name>Task 2: Refactor PlaylistEditorPage to use usePlaylistEditor hook</name>
  <files>
    - src/pages/PlaylistEditorPage.jsx
  </files>
  <action>
Update PlaylistEditorPage.jsx to use the new usePlaylistEditor hook:

1. Import hook: `import { usePlaylistEditor } from './hooks';`

2. Get playlistId from params and call hook

3. Remove all state declarations that moved to hook

4. Remove data loading functions and useEffects

5. Remove handler functions now in hook

6. Keep JSX rendering:
   - PlaylistStripItem component (drag-drop timeline item) - keep inline
   - Media library picker UI
   - AI modal
   - Approval/preview modals
   - Form header and controls

The PlaylistStripItem sub-component is complex (~100 lines) and can stay inline since it's tightly coupled to the drag-drop UI.

Target: Under 700 lines (playlist has complex drag-drop UI that's hard to extract further).
  </action>
  <verify>
    - `npm run lint src/pages/PlaylistEditorPage.jsx` passes
    - Page file is under 700 lines: `wc -l src/pages/PlaylistEditorPage.jsx`
  </verify>
  <done>
    - PlaylistEditorPage.jsx uses usePlaylistEditor hook
    - Page reduced from 1917 lines to under 700 lines
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify page functionality</name>
  <files>None (verification only)</files>
  <action>
1. Run lint check:
```bash
npm run lint src/pages/PlaylistEditorPage.jsx src/pages/hooks/usePlaylistEditor.js
```

2. Run tests:
```bash
npm test -- --run
```

3. Verify line counts:
```bash
wc -l src/pages/PlaylistEditorPage.jsx src/pages/hooks/usePlaylistEditor.js
```

Fix any issues before completing.
  </action>
  <verify>
    - Lint passes
    - Tests pass (allow pre-existing failures)
    - Line count targets met
  </verify>
  <done>
    - All linting passes
    - No new test regressions
  </done>
</task>

</tasks>

<verification>
1. Hook created: `ls src/pages/hooks/usePlaylistEditor.js`
2. Barrel export updated: `grep "usePlaylistEditor" src/pages/hooks/index.js`
3. Page imports hook: `grep "usePlaylistEditor" src/pages/PlaylistEditorPage.jsx`
4. Line reduction: `wc -l src/pages/PlaylistEditorPage.jsx` shows under 700 lines
5. Lint passes: `npm run lint src/pages/PlaylistEditorPage.jsx`
</verification>

<success_criteria>
- usePlaylistEditor.js hook extracts playlist state, media library, drag-drop, AI, approval
- PlaylistEditorPage.jsx reduced from 1917 to under 700 lines
- All existing functionality preserved (add/remove items, reorder, AI, save template)
- Lint and existing tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/08-page-refactoring/08-03-SUMMARY.md`
</output>
