---
phase: 08-page-refactoring
plan: 08
type: execute
wave: 1
depends_on: []
files_modified:
  - src/pages/MediaLibraryPage.jsx
  - src/pages/components/MediaLibraryComponents.jsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "MediaLibraryPage.jsx is under 800 lines"
    - "All inline components are removed from page file"
    - "Page imports and uses components from MediaLibraryComponents.jsx"
    - "Page functionality is unchanged after refactoring"
  artifacts:
    - path: "src/pages/MediaLibraryPage.jsx"
      provides: "Main page component using imported sub-components"
      max_lines: 800
    - path: "src/pages/components/MediaLibraryComponents.jsx"
      provides: "All extracted sub-components"
      exports: ["LimitWarningBanner", "MediaListRow", "MediaGridCard", "FolderGridCard", "FolderBreadcrumbs", "DeleteConfirmModal", "LimitReachedModal", "FolderCreateModal", "MoveToFolderModal", "AddToPlaylistModal", "SetToScreenModal", "MEDIA_TYPE_ICONS", "MEDIA_TYPE_LABELS"]
  key_links:
    - from: "src/pages/MediaLibraryPage.jsx"
      to: "src/pages/components/MediaLibraryComponents.jsx"
      via: "import statement"
      pattern: "from.*MediaLibraryComponents"
---

<objective>
Refactor MediaLibraryPage.jsx to use existing extracted components from MediaLibraryComponents.jsx.

Purpose: MediaLibraryPage is 104% over target (1629 lines vs 800). The extracted components file ALREADY EXISTS (src/pages/components/MediaLibraryComponents.jsx, 805 lines) with all the sub-components, but the page is NOT importing them. The inline definitions are duplicated. This plan wires the page to use the extracted components.

Output: MediaLibraryPage.jsx under 800 lines by removing inline component definitions and importing from MediaLibraryComponents.jsx
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-page-refactoring/08-VERIFICATION.md
@src/pages/MediaLibraryPage.jsx
@src/pages/components/MediaLibraryComponents.jsx
@src/pages/hooks/useMediaLibrary.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Compare prop signatures and resolve mismatches FIRST</name>
  <files>
    src/pages/MediaLibraryPage.jsx
    src/pages/components/MediaLibraryComponents.jsx
  </files>
  <action>
CRITICAL: Before removing inline definitions, verify prop signatures match to avoid runtime errors.

1. Compare each component's props between inline (MediaLibraryPage.jsx) and extracted (MediaLibraryComponents.jsx):

   a. LimitWarningBanner:
      - Inline: { limits, onUpgrade }
      - Extracted: { limits, onUpgrade }
      - Status: MATCH

   b. MediaListRow:
      - Inline: { asset, actionMenuId, onActionMenuToggle, onEdit, onDuplicate, onDelete, onMove, formatDate, onClick, onDoubleClick, isSelected }
      - Extracted: Same props but button onClick handlers include e.stopPropagation()
      - Status: MATCH (extracted has better event handling)

   c. MediaGridCard:
      - Inline: { asset, formatDate, onClick, onDoubleClick, isSelected, isBulkSelected, onToggleSelect, onDragStart, onDragEnd, onDragOver, onDrop, isDragging, isDragOver, index, onShowPreview, onHidePreview }
      - Extracted: Same props
      - Status: MATCH

   d. FolderGridCard:
      - Inline: { folder, onClick, onDragOver, onDragLeave, onDrop, isDragOver }
      - Extracted: Same props
      - Status: MATCH

   e. FolderBreadcrumbs:
      - Inline: { folderPath, onNavigate }
      - Extracted: Same props
      - Status: MATCH

   f. DeleteConfirmModal:
      - Inline: { deleteConfirm, onClose, onConfirm, deleting }
      - Extracted: Same props
      - Status: MATCH

   g. LimitReachedModal:
      - Inline: { open, onClose, limits, mediaCount } - calls formatLimitDisplay internally from import
      - Extracted: { open, onClose, limits, mediaCount, formatLimitDisplay } - expects formatLimitDisplay as prop
      - Status: MISMATCH - fix extracted version to import formatLimitDisplay internally OR pass it as prop from page

   h. FolderCreateModal:
      - Inline: { open, onClose, folderName, setFolderName, onCreate, creating }
      - Extracted: Same props
      - Status: MATCH

   i. MoveToFolderModal:
      - Inline: { open, onClose, mediaName, folders, onMove, moving }
      - Extracted: Same props
      - Status: MATCH

   j. AddToPlaylistModal:
      - Inline: { open, onClose, mediaName, playlists, onAdd, adding, onCreateNew }
      - Extracted: Same props
      - Status: MATCH

   k. SetToScreenModal:
      - Inline: { open, onClose, mediaName, screens, onSet, setting }
      - Extracted: Same props
      - Status: MATCH

2. Fix the LimitReachedModal mismatch:
   - Option A (preferred): Update MediaLibraryComponents.jsx to import formatLimitDisplay internally
     ```javascript
     import { formatLimitDisplay } from '../../services/limitsService';
     ```
     Then remove formatLimitDisplay from props and use internal import.

   - Option B: Pass formatLimitDisplay as prop when calling LimitReachedModal in page

3. Document any other differences found during comparison.
  </action>
  <verify>
    - `grep "formatLimitDisplay" src/pages/components/MediaLibraryComponents.jsx` shows import from limitsService
    - All 11 components have compatible prop signatures
  </verify>
  <done>Prop signatures verified and mismatches fixed before wiring</done>
</task>

<task type="auto">
  <name>Task 2: Wire page to use extracted components</name>
  <files>
    src/pages/MediaLibraryPage.jsx
    src/pages/components/MediaLibraryComponents.jsx
  </files>
  <action>
1. In MediaLibraryPage.jsx:
   a. Add import statement:
      ```javascript
      import {
        LimitWarningBanner,
        MediaListRow,
        MediaGridCard,
        FolderGridCard,
        FolderBreadcrumbs,
        DeleteConfirmModal,
        LimitReachedModal,
        FolderCreateModal,
        MoveToFolderModal,
        AddToPlaylistModal,
        SetToScreenModal,
        MEDIA_TYPE_ICONS,
        MEDIA_TYPE_LABELS,
      } from './components/MediaLibraryComponents';
      ```

   b. Remove the local MEDIA_TYPE_ICONS and MEDIA_TYPE_LABELS constants (lines 88-104)

   c. Remove ALL inline component definitions:
      - const LimitWarningBanner (lines ~130-149)
      - const MediaListRow (lines ~152-240)
      - const MediaGridCard (lines ~243-377)
      - const FolderGridCard (lines ~380-446)
      - const FolderBreadcrumbs (lines ~449-478)
      - const DeleteConfirmModal (lines ~481-567)
      - const LimitReachedModal (lines ~570-620)
      - const FolderCreateModal (lines ~623-664)
      - const MoveToFolderModal (lines ~667-733)
      - const AddToPlaylistModal (lines ~736-798)
      - const SetToScreenModal (lines ~801-859)

   d. Keep only:
      - Imports at top (with new component import)
      - TYPE_FILTER_OPTIONS and ORIENTATION_FILTER_OPTIONS constants
      - ITEMS_PER_PAGE_OPTIONS constant
      - MediaLibraryPage main component

2. The extracted components file already has proper exports - verify they are exported:
   ```javascript
   export const LimitWarningBanner = ...
   export const MediaListRow = ...
   // etc.
   ```

3. Remove formatLimitDisplay import from MediaLibraryPage.jsx if it was only used by LimitReachedModal (now handled internally in extracted component).
  </action>
  <verify>
    - `wc -l src/pages/MediaLibraryPage.jsx` shows under 800 lines
    - `grep "from.*MediaLibraryComponents" src/pages/MediaLibraryPage.jsx` shows import
    - `npm run lint -- src/pages/MediaLibraryPage.jsx` passes
    - `npm run build` succeeds
  </verify>
  <done>MediaLibraryPage.jsx is under 800 lines, imports components from MediaLibraryComponents.jsx</done>
</task>

<task type="auto">
  <name>Task 3: Verify page functionality</name>
  <files>src/pages/MediaLibraryPage.jsx</files>
  <action>
1. Run existing tests:
   - `npm test -- --run` (should pass all tests)

2. Verify build succeeds:
   - No "module not found" errors
   - No prop type mismatches in console

3. Confirm all modals and components render correctly:
   - DeleteConfirmModal, LimitReachedModal, FolderCreateModal, MoveToFolderModal, AddToPlaylistModal, SetToScreenModal
   - MediaGridCard, MediaListRow, FolderGridCard, FolderBreadcrumbs, LimitWarningBanner

4. Verify no inline const definitions remain:
   - `grep "^const LimitWarningBanner" src/pages/MediaLibraryPage.jsx` returns nothing
   - `grep "^const MediaListRow" src/pages/MediaLibraryPage.jsx` returns nothing
   - (repeat for all 11 components)
  </action>
  <verify>
    - `npm test -- --run` passes
    - `npm run build` succeeds without warnings
    - No inline const definitions for the 11 extracted components remain in page
  </verify>
  <done>All tests pass, build succeeds, page uses imported components exclusively</done>
</task>

</tasks>

<verification>
- MediaLibraryPage.jsx line count under 800
- Import from MediaLibraryComponents.jsx present
- No inline component definitions remain
- npm run lint passes
- npm run build succeeds
- npm test passes
</verification>

<success_criteria>
1. MediaLibraryPage.jsx is under 800 lines
2. Page imports all 11 sub-components + MEDIA_TYPE_ICONS + MEDIA_TYPE_LABELS from MediaLibraryComponents.jsx
3. Prop signatures verified compatible before wiring
4. LimitReachedModal formatLimitDisplay mismatch resolved
5. No duplicate inline component definitions in page
6. Page functionality unchanged (grid/list views, modals, folders work)
7. Build and tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/08-page-refactoring/08-08-SUMMARY.md`
</output>
