---
phase: 08-page-refactoring
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/pages/hooks/index.js
  - src/pages/hooks/useFeatureFlags.js
  - src/pages/FeatureFlagsPage.jsx
autonomous: true

must_haves:
  truths:
    - "FeatureFlagsPage renders all 5 tabs (flags, experiments, feedback, announcements, debug)"
    - "Data loads correctly when switching tabs"
    - "CRUD operations work for flags, experiments, and announcements"
    - "Modal state management works correctly"
  artifacts:
    - path: "src/pages/hooks/index.js"
      provides: "Barrel export for page hooks"
      exports: ["useFeatureFlags"]
    - path: "src/pages/hooks/useFeatureFlags.js"
      provides: "Data fetching, modal state, CRUD operations for feature flags page"
      min_lines: 150
    - path: "src/pages/FeatureFlagsPage.jsx"
      provides: "Refactored page using useFeatureFlags hook"
      max_lines: 600
  key_links:
    - from: "src/pages/FeatureFlagsPage.jsx"
      to: "src/pages/hooks/useFeatureFlags.js"
      via: "import { useFeatureFlags }"
      pattern: "useFeatureFlags"
    - from: "src/pages/hooks/useFeatureFlags.js"
      to: "services/featureFlagService"
      via: "getAllFeatureFlags, createFeatureFlag, etc."
      pattern: "featureFlagService"
---

<objective>
Extract custom hook from FeatureFlagsPage.jsx to reduce complexity and establish page hooks infrastructure.

Purpose: FeatureFlagsPage (1339 lines) is the lowest complexity target. Extracting its data/modal state into useFeatureFlags establishes the src/pages/hooks/ pattern for subsequent pages.

Output: useFeatureFlags.js hook, barrel export, refactored page under ~500 lines.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-page-refactoring/08-RESEARCH.md

# Reference patterns from Phase 7
@src/player/hooks/index.js
@src/player/hooks/usePlayerContent.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create pages hooks infrastructure and useFeatureFlags hook</name>
  <files>
    - src/pages/hooks/index.js
    - src/pages/hooks/useFeatureFlags.js
  </files>
  <action>
Create src/pages/hooks/ directory with barrel export pattern matching src/player/hooks/.

Create useFeatureFlags.js hook that extracts from FeatureFlagsPage.jsx:
- Data state: flags, experiments, feedback, announcements arrays
- Loading/error state: loading, error
- Tab state: activeTab (drives which data loads)
- Modal state: showFlagModal, showExperimentModal, showAnnouncementModal, editingItem
- Actions: loadTabData, handleRefresh
- CRUD callbacks: handleCreateFlag, handleUpdateFlag, handleDeleteFlag, handleToggleFlag (for flags)
- CRUD callbacks: handleCreateExperiment, handleUpdateExperimentStatus, handleDeleteExperiment (for experiments)
- CRUD callbacks: handleUpdateFeedbackStatus (for feedback)
- CRUD callbacks: handleCreateAnnouncement, handleUpdateAnnouncement, handleDeleteAnnouncement (for announcements)

Hook signature:
```javascript
export function useFeatureFlags() {
  // Returns all state and actions
  return {
    // Tab state
    activeTab, setActiveTab,
    // Data state
    flags, experiments, feedback, announcements,
    loading, error,
    // Modal state
    showFlagModal, setShowFlagModal,
    showExperimentModal, setShowExperimentModal,
    showAnnouncementModal, setShowAnnouncementModal,
    editingItem, setEditingItem,
    // Actions
    handleRefresh,
    // Flag CRUD
    handleCreateFlag, handleUpdateFlag, handleDeleteFlag, handleToggleFlag,
    // Experiment CRUD
    handleCreateExperiment, handleUpdateExperimentStatus, handleDeleteExperiment,
    // Feedback
    handleUpdateFeedbackStatus,
    // Announcement CRUD
    handleCreateAnnouncement, handleUpdateAnnouncement, handleDeleteAnnouncement,
  };
}
```

Use createScopedLogger('useFeatureFlags') for logging (not useLogger since this is a hook, not component).

Barrel export in index.js:
```javascript
export { useFeatureFlags } from './useFeatureFlags.js';
```
  </action>
  <verify>
    - src/pages/hooks/index.js exists with useFeatureFlags export
    - src/pages/hooks/useFeatureFlags.js exports useFeatureFlags function
    - Hook imports all required services (featureFlagService, experimentService, feedbackService)
  </verify>
  <done>
    - useFeatureFlags hook created with all data fetching, modal state, and CRUD operations
    - Barrel export established for page hooks
  </done>
</task>

<task type="auto">
  <name>Task 2: Refactor FeatureFlagsPage to use useFeatureFlags hook</name>
  <files>
    - src/pages/FeatureFlagsPage.jsx
  </files>
  <action>
Update FeatureFlagsPage.jsx to use the new useFeatureFlags hook:

1. Replace inline useState calls with hook destructuring:
```javascript
const {
  activeTab, setActiveTab,
  flags, experiments, feedback, announcements,
  loading, error,
  showFlagModal, setShowFlagModal,
  showExperimentModal, setShowExperimentModal,
  showAnnouncementModal, setShowAnnouncementModal,
  editingItem, setEditingItem,
  handleRefresh,
  handleCreateFlag, handleUpdateFlag, handleDeleteFlag, handleToggleFlag,
  handleCreateExperiment, handleUpdateExperimentStatus, handleDeleteExperiment,
  handleUpdateFeedbackStatus,
  handleCreateAnnouncement, handleUpdateAnnouncement, handleDeleteAnnouncement,
} = useFeatureFlags();
```

2. Remove all state declarations that moved to hook
3. Remove loadTabData function and useEffect (now in hook)
4. Remove inline CRUD handler functions (now in hook)
5. Keep JSX rendering, tab components (FeatureFlagsTab, ExperimentsTab, etc.), and modals
6. Update modal onSave/onDelete callbacks to use hook functions

The page should retain:
- Role check (super_admin only)
- Tab UI rendering
- Inline tab components (FeatureFlagsTab, ExperimentsTab, FeedbackTab, AnnouncementsTab)
- Modal rendering
- Design system imports

Target: Under 600 lines (allows room for inline tab components which are substantial).
  </action>
  <verify>
    - `npm run lint src/pages/FeatureFlagsPage.jsx` passes (no ESLint errors)
    - Page file is under 600 lines: `wc -l src/pages/FeatureFlagsPage.jsx`
  </verify>
  <done>
    - FeatureFlagsPage.jsx uses useFeatureFlags hook
    - Page reduced from 1339 lines to under 600 lines
    - All imports and exports are correct
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify page functionality and run tests</name>
  <files>None (verification only)</files>
  <action>
1. Run lint check:
```bash
npm run lint src/pages/FeatureFlagsPage.jsx src/pages/hooks/
```

2. Run existing tests to ensure no regressions:
```bash
npm test -- --run
```

3. Verify line counts:
```bash
wc -l src/pages/FeatureFlagsPage.jsx src/pages/hooks/useFeatureFlags.js
```

4. Check imports resolve:
```bash
grep -r "from.*pages/hooks" src/pages/FeatureFlagsPage.jsx
```

If any tests fail, fix issues before completing.
  </action>
  <verify>
    - `npm run lint` passes for modified files
    - Existing test suite passes (allow pre-existing failures)
    - FeatureFlagsPage.jsx under 600 lines
    - useFeatureFlags.js is at least 150 lines
  </verify>
  <done>
    - All linting passes
    - No new test regressions
    - Line count targets met
  </done>
</task>

</tasks>

<verification>
1. Hook infrastructure: `ls src/pages/hooks/` shows index.js and useFeatureFlags.js
2. Barrel export: `grep "useFeatureFlags" src/pages/hooks/index.js`
3. Page imports hook: `grep "useFeatureFlags" src/pages/FeatureFlagsPage.jsx`
4. Line reduction: `wc -l src/pages/FeatureFlagsPage.jsx` shows under 600 lines
5. Lint passes: `npm run lint src/pages/FeatureFlagsPage.jsx src/pages/hooks/`
</verification>

<success_criteria>
- src/pages/hooks/ directory created with barrel export
- useFeatureFlags.js hook extracts data fetching, modal state, and CRUD operations
- FeatureFlagsPage.jsx reduced from 1339 to under 600 lines
- All existing functionality preserved (tabs, CRUD, modals)
- Lint and existing tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/08-page-refactoring/08-01-SUMMARY.md`
</output>
