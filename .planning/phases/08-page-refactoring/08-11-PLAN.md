---
phase: 08-page-refactoring
plan: 11
type: execute
wave: 1
depends_on: []
files_modified:
  - src/pages/CampaignEditorPage.jsx
  - src/pages/components/CampaignEditorComponents.jsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "CampaignEditorPage.jsx is under 600 lines"
    - "All inline modal components are extracted"
    - "Page functionality is unchanged after extraction"
  artifacts:
    - path: "src/pages/components/CampaignEditorComponents.jsx"
      provides: "Extracted modals for CampaignEditorPage"
      exports: ["TargetPickerModal", "ContentPickerModal", "ApprovalRequestModal", "PreviewLinksModal"]
    - path: "src/pages/CampaignEditorPage.jsx"
      provides: "Main page component"
      max_lines: 600
  key_links:
    - from: "src/pages/CampaignEditorPage.jsx"
      to: "src/pages/components/CampaignEditorComponents.jsx"
      via: "import statement"
      pattern: "from.*CampaignEditorComponents"
---

<objective>
Extract inline modal components from CampaignEditorPage.jsx to reach 600-line target.

Purpose: CampaignEditorPage is 76% over target (1054 lines vs 600). Hook extraction (08-02) moved state logic out but inline modals remain. Extracting only TargetPickerModal (~148 lines) and ContentPickerModal (~110 lines) would leave ~791 lines - STILL OVER TARGET. Additional modal extraction is required.

Output: CampaignEditorPage.jsx under 600 lines with all modals extracted to src/pages/components/CampaignEditorComponents.jsx
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-page-refactoring/08-VERIFICATION.md
@src/pages/CampaignEditorPage.jsx
@src/pages/hooks/useCampaignEditor.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extract all modal components</name>
  <files>
    src/pages/components/CampaignEditorComponents.jsx
    src/pages/CampaignEditorPage.jsx
  </files>
  <action>
Create src/pages/components/CampaignEditorComponents.jsx containing:

1. Move these inline components from CampaignEditorPage.jsx:
   - TargetPickerModal (lines 792-939, ~148 lines) - picks screens/groups/locations for campaign targets
   - ContentPickerModal (lines 943-1051, ~110 lines) - picks playlists/layouts for campaign content

2. ALSO extract these modals to reach target (REQUIRED - extracting only the above leaves 791 lines, still over 600):
   - ApprovalRequestModal (lines 560-626, ~67 lines) - Request approval modal with message field
   - PreviewLinksModal (lines 628-786, ~159 lines) - Preview link creation and management modal

3. Add necessary imports at top of new file:
   - React hooks (useState)
   - Design system components (Modal, ModalHeader, ModalTitle, ModalContent, ModalFooter, Button, Card)
   - Lucide icons (X, Monitor, Users, MapPin, Globe, ListMusic, Layout, Check, Loader2, Send, AlertCircle, Plus, Link2, Copy, ExternalLink, Trash2, Calendar, MessageSquare)
   - Preview service imports (formatPreviewLink, EXPIRY_PRESETS, getExpiryLabel)

4. Export all 4 modal components.

5. Update CampaignEditorPage.jsx:
   - Import all modals from './components/CampaignEditorComponents'
   - Remove inline modal function definitions
   - Keep main CampaignEditorPage component, useCampaignEditor import, and page layout

6. Modal props interface:
   - TargetPickerModal: { screens, screenGroups, locations, existingTargets, onSelect, onClose }
   - ContentPickerModal: { playlists, layouts, existingContents, onSelect, onClose }
   - ApprovalRequestModal: { showApprovalModal, setShowApprovalModal, approvalMessage, setApprovalMessage, submittingApproval, handleSubmitForApproval }
   - PreviewLinksModal: { showPreviewModal, setShowPreviewModal, previewLinks, loadingPreviewLinks, creatingPreviewLink, selectedExpiry, setSelectedExpiry, allowComments, setAllowComments, copiedLinkId, handleCreatePreviewLink, handleRevokePreviewLink, handleCopyLink }

7. Line count math:
   - Current: 1054 lines
   - TargetPickerModal: ~148 lines
   - ContentPickerModal: ~110 lines
   - ApprovalRequestModal: ~67 lines
   - PreviewLinksModal: ~159 lines
   - Total extraction: ~484 lines
   - Expected result: 1054 - 484 = ~570 lines (under 600)
  </action>
  <verify>
    - `wc -l src/pages/CampaignEditorPage.jsx` shows under 600 lines
    - `wc -l src/pages/components/CampaignEditorComponents.jsx` shows ~500+ lines
    - `npm run lint -- src/pages/CampaignEditorPage.jsx src/pages/components/CampaignEditorComponents.jsx` passes
    - `npm run build` succeeds
  </verify>
  <done>CampaignEditorPage.jsx is under 600 lines, all modals extracted</done>
</task>

<task type="auto">
  <name>Task 2: Verify page functionality</name>
  <files>src/pages/CampaignEditorPage.jsx</files>
  <action>
1. Run existing tests:
   - `npm test -- --run` (should pass all tests)

2. Check that imports resolve:
   - No "module not found" errors
   - All 4 modal components imported and used

3. Confirm all modals render and function:
   - Target picker shows screens, groups, locations tabs
   - Content picker shows playlists, layouts tabs
   - Approval request modal accepts message
   - Preview links modal creates/revokes links
   - onSelect and onClose callbacks work correctly
  </action>
  <verify>
    - `npm test -- --run` passes
    - `npm run build` succeeds
    - Grep confirms modals imported: `grep "from.*CampaignEditorComponents" src/pages/CampaignEditorPage.jsx`
  </verify>
  <done>All tests pass, build succeeds, all modal functionality preserved</done>
</task>

</tasks>

<verification>
- CampaignEditorPage.jsx line count under 600
- CampaignEditorComponents.jsx exports all 4 modals
- npm run lint passes for both files
- npm run build succeeds
- npm test passes
</verification>

<success_criteria>
1. CampaignEditorPage.jsx is under 600 lines
2. All 4 modals extracted: TargetPickerModal, ContentPickerModal, ApprovalRequestModal, PreviewLinksModal
3. Modal functionality works (picker selection, approval submission, link management)
4. Build and tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/08-page-refactoring/08-11-SUMMARY.md`
</output>
