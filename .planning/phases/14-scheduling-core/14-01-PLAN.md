---
phase: 14-scheduling-core
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - package-lock.json
  - src/components/schedules/DateDurationPicker.jsx
  - src/components/schedules/PriorityBadge.jsx
  - src/components/schedules/index.js
  - src/pages/ScheduleEditorPage.jsx
autonomous: true

must_haves:
  truths:
    - "User can select start date from inline calendar"
    - "User can choose duration preset or set custom end date"
    - "User sees named priority level (Lowest/Low/Normal/High/Critical) with color badge"
    - "New schedule entries save with start_date, end_date, and priority fields"
  artifacts:
    - path: "src/components/schedules/DateDurationPicker.jsx"
      provides: "Inline calendar with duration presets"
      min_lines: 80
    - path: "src/components/schedules/PriorityBadge.jsx"
      provides: "5-level priority display with colors"
      min_lines: 40
  key_links:
    - from: "src/pages/ScheduleEditorPage.jsx"
      to: "DateDurationPicker"
      via: "import and render in entry form"
      pattern: "DateDurationPicker"
    - from: "src/pages/ScheduleEditorPage.jsx"
      to: "PriorityBadge"
      via: "import and render in entry row"
      pattern: "PriorityBadge"
---

<objective>
Create date range and priority UI components for scheduling

Purpose: Enable users to set start/end dates with duration presets and assign named priority levels to schedule entries, addressing SCHED-01 and SCHED-02 requirements.

Output: DateDurationPicker component, PriorityBadge component, integration into ScheduleEditorPage
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-scheduling-core/14-CONTEXT.md
@.planning/phases/14-scheduling-core/14-RESEARCH.md
@src/pages/ScheduleEditorPage.jsx
@src/components/schedules/index.js
@src/design-system/components/Badge.jsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install date/time and drag-drop dependencies</name>
  <files>package.json, package-lock.json</files>
  <action>
Install required npm packages for Phase 14:

```bash
npm install @date-fns/tz @dnd-kit/core @dnd-kit/utilities
```

These provide:
- @date-fns/tz: Timezone-aware date handling for DST safety (TZDate, tzOffset)
- @dnd-kit/core: Drag-and-drop framework for week preview (installed now for Plan 03)
- @dnd-kit/utilities: CSS transform utilities for drag operations

Verify installation by checking package.json contains all three dependencies.
  </action>
  <verify>Run `npm ls @date-fns/tz @dnd-kit/core @dnd-kit/utilities` - all three should show installed versions</verify>
  <done>All three packages appear in package.json dependencies with valid versions</done>
</task>

<task type="auto">
  <name>Task 2: Create DateDurationPicker and PriorityBadge components</name>
  <files>
    src/components/schedules/DateDurationPicker.jsx
    src/components/schedules/PriorityBadge.jsx
    src/components/schedules/index.js
  </files>
  <action>
**DateDurationPicker.jsx:**

Create inline calendar with duration presets per CONTEXT.md decisions:
- Start date + duration approach (NOT calendar range picker)
- Inline calendar always visible for start date selection
- Duration presets dropdown:
  - Time-based: "1 day", "3 days", "1 week", "2 weeks", "1 month", "Custom"
  - Use-case based: "Daily special", "Weekend only", "This week", "Seasonal"
  - Open-ended: "No end date / Until further notice"
- Date + time precision with start/end time pickers

Props:
- startDate: Date | null
- endDate: Date | null (null = no end date)
- startTime: string (HH:mm format)
- endTime: string (HH:mm format)
- onChange: ({ startDate, endDate, startTime, endTime }) => void
- timezone: string (default: 'UTC')

Implementation:
- Use date-fns for date manipulation (format, addDays, addWeeks, addMonths, startOfWeek, eachDayOfInterval, isSameDay, isSameMonth)
- Build 7-column grid calendar showing current month
- Highlight selected start date, show calculated end date
- Duration dropdown calculates end date from start date
- Time inputs use native time picker or simple HH:mm input

**PriorityBadge.jsx:**

Create priority display following CONTEXT.md decisions:
- Named levels: Lowest / Low / Normal / High / Critical (values 1-5)
- Display: color badge + text label
- Default priority: Normal (3)

Props:
- priority: number (1-5)
- size: 'sm' | 'md' | 'lg' (default: 'md')
- showLabel: boolean (default: true)
- onChange: (newPriority: number) => void (optional, for editable mode)

Priority config:
```javascript
const PRIORITY_LEVELS = [
  { value: 1, label: 'Lowest', color: 'bg-gray-100 text-gray-600', dot: 'bg-gray-400' },
  { value: 2, label: 'Low', color: 'bg-blue-50 text-blue-700', dot: 'bg-blue-400' },
  { value: 3, label: 'Normal', color: 'bg-green-50 text-green-700', dot: 'bg-green-500' },
  { value: 4, label: 'High', color: 'bg-amber-50 text-amber-700', dot: 'bg-amber-500' },
  { value: 5, label: 'Critical', color: 'bg-red-50 text-red-700', dot: 'bg-red-500' }
];
```

Follow existing Badge.jsx patterns from design-system for consistency.

**Update index.js:**
Add exports for new components:
```javascript
export { DateDurationPicker } from './DateDurationPicker';
export { PriorityBadge, PRIORITY_LEVELS } from './PriorityBadge';
```
  </action>
  <verify>
Run `npm run build` - should compile without errors.
Check components exist and export correctly:
```bash
grep -l "DateDurationPicker\|PriorityBadge" src/components/schedules/*.jsx
```
  </verify>
  <done>
- DateDurationPicker renders inline calendar with duration presets
- PriorityBadge displays 5 named levels with appropriate colors
- Both exported from index.js barrel
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate components into ScheduleEditorPage</name>
  <files>src/pages/ScheduleEditorPage.jsx</files>
  <action>
Integrate new components into the schedule entry form:

**1. Import new components:**
```javascript
import { DateDurationPicker, PriorityBadge, PRIORITY_LEVELS } from '../components/schedules';
```

**2. Update entry form state:**
Add to entry editing state:
- priority (number, default: 3 for Normal)
- Ensure start_date, end_date already exist in schema

**3. Add DateDurationPicker to entry form:**
Replace or augment existing date/time inputs:
- Position: After content selection, before repeat options
- Pass current startDate, endDate, startTime, endTime from entry state
- Handle onChange to update entry state
- Show timezone from schedule or device

**4. Add PriorityBadge selector to entry form:**
- Position: Near top of entry form, after content selection
- Use editable mode (with dropdown) for selecting priority
- Show current priority as badge with label

**5. Update entry list display:**
- Show PriorityBadge (display mode) for each entry in list
- Existing entries show their priority level

**6. Update save logic:**
- Include priority field when creating/updating schedule entries
- Use scheduleService.createScheduleEntry and updateScheduleEntry with priority

**7. Default values:**
- New entries default to priority: 3 (Normal)
- New entries default to start_date: today, end_date: null (no end)

The existing checkEntryConflicts already accepts start_date and end_date, so conflict checking should work with the new date fields automatically.
  </action>
  <verify>
1. Open ScheduleEditorPage in browser (http://localhost:5173/schedules/{id})
2. Create new entry - should see inline calendar and priority selector
3. Select a start date and duration - end date should calculate
4. Select priority level - badge should update
5. Save entry - should persist with correct start_date, end_date, priority
6. Entry list should show priority badge for saved entry
  </verify>
  <done>
- DateDurationPicker renders in entry form with inline calendar
- PriorityBadge selector allows choosing 5 levels
- New entries save with start_date, end_date, and priority values
- Entry list displays priority badges for each entry
  </done>
</task>

</tasks>

<verification>
Overall phase checks:
1. `npm run build` completes without errors
2. `npm run lint` passes (or only pre-existing warnings)
3. ScheduleEditorPage loads and new components render
4. Can create entry with date range and priority
5. Entry persists to database with correct field values
</verification>

<success_criteria>
- DateDurationPicker component exists with inline calendar and duration presets
- PriorityBadge component exists with 5 named levels and appropriate colors
- Both components integrated into ScheduleEditorPage entry form
- New schedule entries save with start_date, end_date, and priority fields
- Entry list displays priority badges
- No regressions to existing scheduling functionality
</success_criteria>

<output>
After completion, create `.planning/phases/14-scheduling-core/14-01-SUMMARY.md`
</output>
