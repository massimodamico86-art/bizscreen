---
phase: 14-scheduling-core
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - src/pages/ScheduleEditorPage.jsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "User can set start and end dates on schedule entries using DateDurationPicker"
    - "DateDurationPicker calendar is visible in event modal"
    - "Date/time changes from picker update eventForm state"
  artifacts:
    - path: "src/pages/ScheduleEditorPage.jsx"
      provides: "DateDurationPicker rendered in event modal"
      contains: "<DateDurationPicker"
  key_links:
    - from: "ScheduleEditorPage.jsx"
      to: "DateDurationPicker"
      via: "JSX render in event modal"
      pattern: "<DateDurationPicker"
---

<objective>
Wire DateDurationPicker into ScheduleEditorPage event modal

Purpose: Close Gap 1 from VERIFICATION.md - DateDurationPicker is imported but never rendered, blocking Truth #1 ("User can set start and end dates on schedule entries")

Output: DateDurationPicker visible and functional in event modal, replacing basic date/time inputs
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-scheduling-core/14-VERIFICATION.md
@src/pages/ScheduleEditorPage.jsx
@src/components/schedules/DateDurationPicker.jsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Render DateDurationPicker in event modal</name>
  <files>src/pages/ScheduleEditorPage.jsx</files>
  <action>
    Replace the existing date/time input sections in the event modal with the DateDurationPicker component.

    Location: Around line 1001-1049 in ScheduleEditorPage.jsx (the "Event Starts" and "Event Ends" sections).

    1. Remove the "Event Starts" div (lines ~1001-1024) and "Event Ends" div (lines ~1026-1049) sections with their manual date and time inputs

    2. In their place, add a single DateDurationPicker component:
    ```jsx
    {/* Date and Time Selection (SCHED-01) */}
    <div className="mb-4">
      <DateDurationPicker
        startDate={eventForm.startDate ? new Date(eventForm.startDate + 'T00:00:00') : null}
        endDate={eventForm.endDate ? new Date(eventForm.endDate + 'T00:00:00') : null}
        startTime={eventForm.startTime}
        endTime={eventForm.endTime}
        onChange={({ startDate, endDate, startTime, endTime }) => {
          setEventForm(prev => ({
            ...prev,
            startDate: startDate ? startDate.toISOString().split('T')[0] : prev.startDate,
            endDate: endDate ? endDate.toISOString().split('T')[0] : prev.endDate,
            startTime: startTime || prev.startTime,
            endTime: endTime || prev.endTime
          }));
        }}
        timezone="Device Local"
      />
    </div>
    ```

    3. Keep the existing REPEAT OPTIONS section that follows (starting around line 1052)

    Important: The DateDurationPicker expects Date objects for startDate/endDate but stores string format (YYYY-MM-DD) in eventForm. Handle the conversion in onChange and when passing props.
  </action>
  <verify>
    1. Open ScheduleEditorPage in browser, click "+" or edit an existing event
    2. Verify DateDurationPicker calendar is visible in modal
    3. Click a date in calendar, verify eventForm.startDate updates
    4. Change duration dropdown, verify eventForm.endDate updates
    5. Change time inputs, verify eventForm.startTime/endTime update
    6. Save event, verify dates persist correctly
  </verify>
  <done>DateDurationPicker renders in event modal, date/time selection functional, existing date inputs removed</done>
</task>

<task type="auto">
  <name>Task 2: Verify form data flow and save operation</name>
  <files>src/pages/ScheduleEditorPage.jsx</files>
  <action>
    Verify the existing handleSaveEvent function correctly uses the eventForm date/time values that now come from DateDurationPicker.

    1. Check handleSaveEvent (around line 444):
       - start_date: eventForm.startDate
       - start_time: eventForm.startTime
       - end_date: eventForm.endDate
       - end_time: eventForm.endTime

    This should already be correct since we're updating the same eventForm state, but verify the data types match what createScheduleEntry/updateScheduleEntry expect (string format YYYY-MM-DD for dates, HH:mm for times).

    2. Check openNewEventModal (around line 394):
       - Ensure startDate/endDate are still initialized as string format (formatDateInput returns YYYY-MM-DD)

    3. Check openEditEventModal (around line 420):
       - Ensure existing entry dates are loaded into eventForm correctly

    No code changes expected if data flow is correct. If there are mismatches, fix them.
  </action>
  <verify>
    1. Create new event with DateDurationPicker, save it
    2. Reload page, verify dates display correctly in entry list
    3. Edit existing event, verify DateDurationPicker shows correct dates
    4. Change dates and save, verify changes persist
  </verify>
  <done>Date/time data flows correctly from DateDurationPicker through eventForm to database</done>
</task>

</tasks>

<verification>
After both tasks complete:
1. Event modal shows DateDurationPicker with inline calendar
2. Clicking calendar dates updates form
3. Duration presets calculate end dates correctly
4. Time inputs work within DateDurationPicker
5. Save and edit operations preserve date/time values
6. No console errors related to date handling
</verification>

<success_criteria>
- DateDurationPicker visually present in event modal (not hidden)
- Calendar interaction updates eventForm state
- Events can be created and edited with date ranges
- Existing events load their dates into DateDurationPicker correctly
- Truth #1 from VERIFICATION.md now passable: "User can set start and end dates on schedule entries"
</success_criteria>

<output>
After completion, create `.planning/phases/14-scheduling-core/14-04-SUMMARY.md`
</output>
