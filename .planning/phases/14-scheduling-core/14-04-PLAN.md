---
phase: 14-scheduling-core
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - src/pages/ScheduleEditorPage.jsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "User can set start and end dates on schedule entries using DateDurationPicker"
    - "DateDurationPicker calendar is visible in event modal"
    - "Date/time changes from picker update eventForm state"
  artifacts:
    - path: "src/pages/ScheduleEditorPage.jsx"
      provides: "DateDurationPicker rendered in event modal"
      contains: "<DateDurationPicker"
  key_links:
    - from: "ScheduleEditorPage.jsx"
      to: "DateDurationPicker"
      via: "JSX render in event modal"
      pattern: "<DateDurationPicker"
    - from: "DateDurationPicker props"
      to: "eventForm state"
      via: "props match state fields"
      pattern: "eventForm.startDate.*eventForm.endDate.*eventForm.startTime.*eventForm.endTime"
---

<objective>
Wire DateDurationPicker into ScheduleEditorPage event modal

Purpose: Close Gap 1 from VERIFICATION.md - DateDurationPicker is imported but never rendered, blocking Truth #1 ("User can set start and end dates on schedule entries")

Output: DateDurationPicker visible and functional in event modal, replacing basic date/time inputs
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-scheduling-core/14-VERIFICATION.md
@src/pages/ScheduleEditorPage.jsx
@src/components/schedules/DateDurationPicker.jsx
</context>

<tasks>

<task type="auto">
  <name>Task 1a: Render DateDurationPicker in event modal</name>
  <files>src/pages/ScheduleEditorPage.jsx</files>
  <action>
    Replace the existing date/time input sections in the event modal with the DateDurationPicker component.

    Location: Around line 1001-1049 in ScheduleEditorPage.jsx (the "Event Starts" and "Event Ends" sections).

    1. Remove the "Event Starts" div (lines ~1001-1024) and "Event Ends" div (lines ~1026-1049) sections with their manual date and time inputs

    2. In their place, add a single DateDurationPicker component:
    ```jsx
    {/* Date and Time Selection (SCHED-01) */}
    <div className="mb-4">
      <DateDurationPicker
        startDate={eventForm.startDate ? new Date(eventForm.startDate + 'T00:00:00') : null}
        endDate={eventForm.endDate ? new Date(eventForm.endDate + 'T00:00:00') : null}
        startTime={eventForm.startTime}
        endTime={eventForm.endTime}
        onChange={({ startDate, endDate, startTime, endTime }) => {
          setEventForm(prev => ({
            ...prev,
            startDate: startDate ? startDate.toISOString().split('T')[0] : prev.startDate,
            endDate: endDate ? endDate.toISOString().split('T')[0] : prev.endDate,
            startTime: startTime || prev.startTime,
            endTime: endTime || prev.endTime
          }));
        }}
        timezone="Device Local"
      />
    </div>
    ```

    3. Keep the existing REPEAT OPTIONS section that follows (starting around line 1052)

    Important: The DateDurationPicker expects Date objects for startDate/endDate but stores string format (YYYY-MM-DD) in eventForm. Handle the conversion in onChange and when passing props.

    Note: eventForm state already includes startDate, endDate, startTime, endTime fields (verified at line 144-159 of ScheduleEditorPage.jsx), so props match state schema.
  </action>
  <verify>
    1. Run: `grep -n "<DateDurationPicker" src/pages/ScheduleEditorPage.jsx` - should show JSX render (not just import)
    2. Run: `grep -n "eventForm.startDate.*eventForm.endDate" src/pages/ScheduleEditorPage.jsx` - should show props passing
    3. Run: `npm run build` - no import or JSX errors
  </verify>
  <done>DateDurationPicker JSX element added to event modal, props connected to eventForm state</done>
</task>

<task type="auto">
  <name>Task 1b: Wire onChange handlers with date conversions</name>
  <files>src/pages/ScheduleEditorPage.jsx</files>
  <action>
    Verify and test the onChange handler wiring added in Task 1a.

    The onChange handler must:
    1. Convert Date objects from DateDurationPicker to YYYY-MM-DD strings for eventForm
    2. Preserve existing values when a partial update occurs (null checks)
    3. Handle both date and time fields in a single update

    Verify the conversion logic:
    - `startDate.toISOString().split('T')[0]` produces "YYYY-MM-DD" format
    - Time values pass through as-is (already "HH:mm" strings)

    Test by reading the rendered component to confirm:
    1. Props use correct eventForm fields
    2. onChange handler updates all four fields correctly
    3. Date object to string conversion is correct

    If the onChange handler from Task 1a has issues, fix them:
    - If toISOString produces wrong timezone offset, use: `${startDate.getFullYear()}-${String(startDate.getMonth()+1).padStart(2,'0')}-${String(startDate.getDate()).padStart(2,'0')}`
    - If time values aren't updating, ensure startTime/endTime are correctly extracted from onChange params
  </action>
  <verify>
    1. Run: `grep -A5 "onChange={" src/pages/ScheduleEditorPage.jsx | grep -A5 "DateDurationPicker" | head -20` - should show onChange handler
    2. Run: `grep -n "setEventForm.*startDate.*endDate" src/pages/ScheduleEditorPage.jsx` - should show state updates
    3. Run: `npm run build` - compiles without errors
  </verify>
  <done>onChange handlers correctly convert DateDurationPicker outputs to eventForm schema</done>
</task>

<task type="auto">
  <name>Task 2: Verify form data flow end-to-end</name>
  <files>src/pages/ScheduleEditorPage.jsx</files>
  <action>
    Verify the handleSaveEvent function correctly uses the eventForm date/time values that now come from DateDurationPicker.

    1. Read handleSaveEvent (around line 444) and confirm these mappings:
       - start_date: eventForm.startDate (expects YYYY-MM-DD string)
       - start_time: eventForm.startTime (expects HH:mm string)
       - end_date: eventForm.endDate (expects YYYY-MM-DD string)
       - end_time: eventForm.endTime (expects HH:mm string)

    2. Read openNewEventModal (around line 394) and confirm:
       - startDate initialized via formatDateInput (produces YYYY-MM-DD)
       - startTime/endTime initialized as HH:mm strings

    3. Read openEditEventModal (around line 420) and confirm:
       - Existing entry dates loaded into eventForm correctly

    If any data format mismatches exist between DateDurationPicker output and handleSaveEvent expectations, fix them:
    - If handleSaveEvent expects different date format, update onChange conversion
    - If times need padding (e.g., "8:00" vs "08:00"), add zero-padding

    If all data flows match (most likely case since eventForm schema is unchanged), document verification in summary.
  </action>
  <verify>
    1. Run: `grep -n "start_date.*eventForm\|eventForm.*start_date" src/pages/ScheduleEditorPage.jsx` - should show handleSaveEvent uses eventForm.startDate
    2. Run: `grep -n "formatDateInput" src/pages/ScheduleEditorPage.jsx | head -5` - confirm format function exists
    3. Run: `npm run build` - no errors
  </verify>
  <done>Data flow verified: DateDurationPicker -> eventForm -> handleSaveEvent uses consistent YYYY-MM-DD and HH:mm formats</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `grep -n "<DateDurationPicker" src/pages/ScheduleEditorPage.jsx` shows component rendered (not just imported)
2. `npm run build` succeeds with no errors
3. Event modal shows DateDurationPicker with inline calendar
4. Clicking calendar dates updates form
5. Duration presets calculate end dates correctly
6. Time inputs work within DateDurationPicker
7. Save and edit operations preserve date/time values
8. No console errors related to date handling
</verification>

<success_criteria>
- DateDurationPicker visually present in event modal (not hidden)
- Calendar interaction updates eventForm state
- Events can be created and edited with date ranges
- Existing events load their dates into DateDurationPicker correctly
- Truth #1 from VERIFICATION.md now passable: "User can set start and end dates on schedule entries"
</success_criteria>

<output>
After completion, create `.planning/phases/14-scheduling-core/14-04-SUMMARY.md`
</output>
