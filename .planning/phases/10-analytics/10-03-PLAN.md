---
phase: 10-analytics
plan: 03
type: execute
wave: 2
depends_on: []
files_modified:
  - src/components/analytics/ViewingHeatmap.jsx
autonomous: true

must_haves:
  truths:
    - "Heatmap displays 7x24 grid (days x hours)"
    - "Empty cells show with neutral color"
    - "Hover tooltip shows day, hour, and view count"
    - "Color intensity reflects view count relative to maximum"
  artifacts:
    - path: "src/components/analytics/ViewingHeatmap.jsx"
      provides: "Viewing heatmap visualization component"
      exports: ["ViewingHeatmap"]
      min_lines: 60
  key_links:
    - from: "ViewingHeatmap"
      to: "data prop"
      via: "grid rendering from heatmap data"
      pattern: "day_of_week.*hour_of_day"
---

<objective>
Create a pure Tailwind CSS heatmap component for displaying viewing patterns by hour and day of week.

Purpose: Fulfill ANA-04 (time-based heatmap shows peak viewing periods).
Output: Reusable ViewingHeatmap component with hover tooltips.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/10-analytics/10-CONTEXT.md
@.planning/phases/10-analytics/10-RESEARCH.md

@src/design-system/components/Card.jsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create analytics components directory</name>
  <files>src/components/analytics/index.js</files>
  <action>
Create directory structure and barrel export:

```javascript
// src/components/analytics/index.js
export { ViewingHeatmap } from './ViewingHeatmap';
```

This sets up the analytics components directory pattern.
  </action>
  <verify>Check directory exists: `ls -la src/components/analytics/`</verify>
  <done>src/components/analytics/ directory created with index.js barrel export</done>
</task>

<task type="auto">
  <name>Task 2: Create ViewingHeatmap component</name>
  <files>src/components/analytics/ViewingHeatmap.jsx</files>
  <action>
Create pure Tailwind CSS heatmap component (per RESEARCH.md - simpler than Recharts for grid):

```jsx
/**
 * ViewingHeatmap Component
 *
 * Displays a 7x24 heatmap grid showing viewing patterns by day of week and hour.
 * Uses pure Tailwind CSS for styling (no external chart library needed).
 */

import { useMemo, useState } from 'react';

const DAYS = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
const HOURS = Array.from({ length: 24 }, (_, i) => i);

/**
 * Get color class based on intensity (0-1 scale)
 * Uses blue color scale per design system
 */
function getColorClass(value, maxValue) {
  if (value === 0 || maxValue === 0) return 'bg-gray-100';
  const intensity = value / maxValue;
  if (intensity > 0.75) return 'bg-blue-600';
  if (intensity > 0.5) return 'bg-blue-400';
  if (intensity > 0.25) return 'bg-blue-300';
  return 'bg-blue-200';
}

/**
 * Format hour for display (12h format)
 */
function formatHour(hour) {
  if (hour === 0) return '12am';
  if (hour === 12) return '12pm';
  if (hour < 12) return `${hour}am`;
  return `${hour - 12}pm`;
}

export function ViewingHeatmap({ data = [], metric = 'view_count', loading = false }) {
  const [hoveredCell, setHoveredCell] = useState(null);

  // Reshape data into grid and find max value
  const { grid, maxValue } = useMemo(() => {
    // Initialize empty 7x24 grid
    const gridData = DAYS.map(() => HOURS.map(() => ({ views: 0, duration: 0 })));
    let max = 0;

    // Populate grid from data
    data.forEach((cell) => {
      const day = cell.day_of_week;
      const hour = cell.hour_of_day;
      if (day >= 0 && day <= 6 && hour >= 0 && hour <= 23) {
        const value = metric === 'duration' ? cell.total_duration_seconds : cell.view_count;
        gridData[day][hour] = {
          views: cell.view_count || 0,
          duration: cell.total_duration_seconds || 0,
        };
        if (value > max) max = value;
      }
    });

    return { grid: gridData, maxValue: max };
  }, [data, metric]);

  if (loading) {
    return (
      <div className="animate-pulse">
        <div className="h-40 bg-gray-100 rounded-lg" />
      </div>
    );
  }

  return (
    <div className="relative">
      <div className="overflow-x-auto pb-2">
        <div
          className="inline-grid gap-0.5"
          style={{ gridTemplateColumns: 'auto repeat(24, minmax(14px, 1fr))' }}
        >
          {/* Header row - hours */}
          <div className="h-5" /> {/* Empty corner cell */}
          {HOURS.map((hour) => (
            <div
              key={hour}
              className="h-5 text-[9px] text-gray-400 text-center flex items-end justify-center"
            >
              {hour % 4 === 0 ? formatHour(hour) : ''}
            </div>
          ))}

          {/* Data rows - one per day */}
          {DAYS.map((day, dayIndex) => (
            <>
              {/* Day label */}
              <div
                key={`label-${day}`}
                className="text-xs text-gray-500 pr-2 flex items-center justify-end"
              >
                {day}
              </div>
              {/* Hour cells for this day */}
              {grid[dayIndex].map((cell, hourIndex) => {
                const value = metric === 'duration' ? cell.duration : cell.views;
                const isHovered =
                  hoveredCell?.day === dayIndex && hoveredCell?.hour === hourIndex;

                return (
                  <div
                    key={`cell-${dayIndex}-${hourIndex}`}
                    className={`
                      h-5 rounded-sm cursor-pointer transition-all
                      ${getColorClass(value, maxValue)}
                      ${isHovered ? 'ring-2 ring-gray-400 ring-offset-1' : ''}
                    `}
                    onMouseEnter={() => setHoveredCell({ day: dayIndex, hour: hourIndex })}
                    onMouseLeave={() => setHoveredCell(null)}
                  />
                );
              })}
            </>
          ))}
        </div>
      </div>

      {/* Hover tooltip */}
      {hoveredCell && (
        <div className="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 z-10">
          <div className="bg-gray-900 text-white text-xs rounded-lg px-3 py-2 shadow-lg whitespace-nowrap">
            <p className="font-medium">
              {DAYS[hoveredCell.day]} {formatHour(hoveredCell.hour)}
            </p>
            <p className="text-gray-300">
              {grid[hoveredCell.day][hoveredCell.hour].views.toLocaleString()} views
            </p>
            <p className="text-gray-300">
              {Math.round(grid[hoveredCell.day][hoveredCell.hour].duration / 60)} min
            </p>
          </div>
        </div>
      )}

      {/* Legend */}
      <div className="flex items-center justify-end gap-2 mt-3 text-xs text-gray-500">
        <span>Less</span>
        <div className="flex gap-0.5">
          <div className="w-3 h-3 bg-gray-100 rounded-sm" />
          <div className="w-3 h-3 bg-blue-200 rounded-sm" />
          <div className="w-3 h-3 bg-blue-300 rounded-sm" />
          <div className="w-3 h-3 bg-blue-400 rounded-sm" />
          <div className="w-3 h-3 bg-blue-600 rounded-sm" />
        </div>
        <span>More</span>
      </div>
    </div>
  );
}

export default ViewingHeatmap;
```

Key implementation notes:
- Pure Tailwind CSS (no Recharts dependency needed)
- Hover state managed with useState
- Grid generated from data with zeros for empty cells
- Tooltip shows both views and duration
- Responsive with horizontal scroll on small screens
- Blue color scale matches design system
  </action>
  <verify>Check component exists and exports: `grep -c 'export.*ViewingHeatmap' src/components/analytics/ViewingHeatmap.jsx`</verify>
  <done>ViewingHeatmap component renders 7x24 grid with hover tooltips and color intensity</done>
</task>

</tasks>

<verification>
- [ ] src/components/analytics/ViewingHeatmap.jsx exists
- [ ] src/components/analytics/index.js exports ViewingHeatmap
- [ ] Component renders 7 rows (days) and 24 columns (hours)
- [ ] Hover shows tooltip with day, time, views, and duration
- [ ] Empty cells show gray-100 color
- [ ] Legend shows color scale
- [ ] No lint errors in the file
</verification>

<success_criteria>
1. Heatmap renders 7x24 grid from data prop
2. Hover tooltips show viewing details (per CONTEXT.md - hover only, no drill-down)
3. Color intensity reflects value relative to maximum
4. Component handles loading state
</success_criteria>

<output>
After completion, create `.planning/phases/10-analytics/10-03-SUMMARY.md`
</output>
