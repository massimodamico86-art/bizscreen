---
phase: 10-analytics
plan: 04
type: execute
wave: 2
depends_on: []
files_modified:
  - src/components/analytics/ContentInlineMetrics.jsx
  - src/components/analytics/index.js
autonomous: true

must_haves:
  truths:
    - "Inline metrics show view duration in human-readable format"
    - "Inline metrics show completion rate as percentage"
    - "Inline metrics show total views count"
    - "Inline metrics show last viewed time"
    - "Link to full analytics page exists"
  artifacts:
    - path: "src/components/analytics/ContentInlineMetrics.jsx"
      provides: "Reusable inline metrics component for content detail pages"
      exports: ["ContentInlineMetrics"]
      min_lines: 50
  key_links:
    - from: "ContentInlineMetrics"
      to: "getContentMetrics"
      via: "useEffect data fetch"
      pattern: "getContentMetrics.*contentId"
---

<objective>
Create a reusable inline metrics component for displaying content analytics on detail pages.

Purpose: Provide consistent metrics display (view duration, completion rate, total views, last viewed) that can be embedded in any content detail page.
Output: ContentInlineMetrics component with loading state and link to full analytics.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/10-analytics/10-CONTEXT.md

@src/services/contentAnalyticsService.js
@src/design-system/components/Card.jsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ContentInlineMetrics component</name>
  <files>src/components/analytics/ContentInlineMetrics.jsx</files>
  <action>
Create inline metrics component for embedding in content detail pages:

```jsx
/**
 * ContentInlineMetrics Component
 *
 * Displays inline analytics summary for content (scene, media, playlist).
 * Shows: View Duration, Completion Rate, Total Views, Last Viewed
 * Includes link to full analytics page.
 */

import { useState, useEffect } from 'react';
import { Link } from 'react-router-dom';
import { Clock, CheckCircle, Eye, Calendar, BarChart2, TrendingUp } from 'lucide-react';
import { Card } from '../../design-system';
import {
  getContentMetrics,
  formatDuration,
  formatRelativeTime,
} from '../../services/contentAnalyticsService';

/**
 * Single metric item display
 */
function MetricItem({ icon: Icon, label, value, subValue, color = 'blue' }) {
  const colorClasses = {
    blue: 'bg-blue-100 text-blue-600',
    green: 'bg-green-100 text-green-600',
    purple: 'bg-purple-100 text-purple-600',
    orange: 'bg-orange-100 text-orange-600',
  };

  return (
    <div className="flex items-center gap-3">
      <div className={`w-9 h-9 rounded-lg flex items-center justify-center ${colorClasses[color]}`}>
        <Icon className="w-4 h-4" />
      </div>
      <div>
        <p className="text-xs text-gray-500">{label}</p>
        <p className="text-sm font-semibold text-gray-900">{value}</p>
        {subValue && <p className="text-xs text-gray-400">{subValue}</p>}
      </div>
    </div>
  );
}

/**
 * Skeleton loading state
 */
function MetricsSkeleton() {
  return (
    <Card padding="sm">
      <div className="animate-pulse">
        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
          {[1, 2, 3, 4].map((i) => (
            <div key={i} className="flex items-center gap-3">
              <div className="w-9 h-9 bg-gray-200 rounded-lg" />
              <div className="flex-1">
                <div className="h-3 bg-gray-200 rounded w-16 mb-1" />
                <div className="h-4 bg-gray-200 rounded w-12" />
              </div>
            </div>
          ))}
        </div>
      </div>
    </Card>
  );
}

export function ContentInlineMetrics({
  contentId,
  contentType, // 'scene' | 'media' | 'playlist'
  dateRange = '7d',
  showLink = true,
  className = '',
}) {
  const [metrics, setMetrics] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    async function loadMetrics() {
      if (!contentId || !contentType) return;

      setLoading(true);
      setError(null);

      try {
        const data = await getContentMetrics(contentId, contentType, dateRange);
        setMetrics(data);
      } catch (err) {
        setError(err.message);
      } finally {
        setLoading(false);
      }
    }

    loadMetrics();
  }, [contentId, contentType, dateRange]);

  if (loading) {
    return <MetricsSkeleton />;
  }

  if (error) {
    return (
      <Card padding="sm" className={className}>
        <p className="text-sm text-red-600">Failed to load analytics</p>
      </Card>
    );
  }

  if (!metrics) {
    return null;
  }

  const completionRate = Math.round(metrics.completion_rate || 0);
  const completionColor = completionRate >= 80 ? 'green' : completionRate >= 50 ? 'orange' : 'blue';

  return (
    <Card padding="sm" className={className}>
      <div className="flex items-center justify-between mb-3">
        <h4 className="text-sm font-medium text-gray-700 flex items-center gap-2">
          <BarChart2 className="w-4 h-4 text-gray-400" />
          Analytics Summary
        </h4>
        {showLink && (
          <Link
            to={`/analytics/content/${contentType}/${contentId}`}
            className="text-xs text-blue-600 hover:text-blue-800 flex items-center gap-1"
          >
            View full analytics
            <TrendingUp className="w-3 h-3" />
          </Link>
        )}
      </div>

      <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
        <MetricItem
          icon={Clock}
          label="Avg. View Duration"
          value={formatDuration(metrics.avg_view_duration_seconds || 0)}
          color="blue"
        />
        <MetricItem
          icon={CheckCircle}
          label="Completion Rate"
          value={`${completionRate}%`}
          color={completionColor}
        />
        <MetricItem
          icon={Eye}
          label="Total Views"
          value={(metrics.total_views || 0).toLocaleString()}
          color="purple"
        />
        <MetricItem
          icon={Calendar}
          label="Last Viewed"
          value={formatRelativeTime(metrics.last_viewed_at)}
          color="orange"
        />
      </div>
    </Card>
  );
}

export default ContentInlineMetrics;
```

Key implementation notes:
- Per CONTEXT.md: inline shows View Duration, Completion Rate, Total Views, Last Viewed
- Uses existing formatDuration and formatRelativeTime from contentAnalyticsService
- Loading skeleton for better UX
- Link to full analytics page when showLink=true
- Completion rate color indicates health (green >= 80%, orange >= 50%)
  </action>
  <verify>Check component exports: `grep -c 'export.*ContentInlineMetrics' src/components/analytics/ContentInlineMetrics.jsx`</verify>
  <done>ContentInlineMetrics component shows 4 metrics with loading state and link to full analytics</done>
</task>

<task type="auto">
  <name>Task 2: Update barrel export</name>
  <files>src/components/analytics/index.js</files>
  <action>
Update the barrel export to include ContentInlineMetrics:

```javascript
// src/components/analytics/index.js
export { ViewingHeatmap } from './ViewingHeatmap';
export { ContentInlineMetrics } from './ContentInlineMetrics';
```

Note: This task runs after 10-03 creates the initial index.js, so we're updating it.
  </action>
  <verify>Check export: `grep 'ContentInlineMetrics' src/components/analytics/index.js`</verify>
  <done>ContentInlineMetrics exported from barrel file</done>
</task>

</tasks>

<verification>
- [ ] src/components/analytics/ContentInlineMetrics.jsx exists
- [ ] Component fetches data via getContentMetrics
- [ ] Shows 4 metrics: View Duration, Completion Rate, Total Views, Last Viewed
- [ ] Loading skeleton displays while fetching
- [ ] Error state shows error message
- [ ] Link to full analytics page works
- [ ] Exported from index.js barrel
- [ ] No lint errors
</verification>

<success_criteria>
1. Component loads metrics for contentId/contentType
2. Displays 4 metrics per CONTEXT.md specification
3. Link navigates to /analytics/content/:type/:id
4. Completion rate shows color-coded health indicator
</success_criteria>

<output>
After completion, create `.planning/phases/10-analytics/10-04-SUMMARY.md`
</output>
