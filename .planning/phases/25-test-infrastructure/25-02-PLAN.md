---
phase: 25-test-infrastructure
plan: 02
type: execute
wave: 2
depends_on: ["25-01"]
files_modified:
  - TEST-PATTERNS.md
  - src/__fixtures__/screens.js
  - src/__fixtures__/playlists.js
  - src/__fixtures__/schedules.js
autonomous: true

must_haves:
  truths:
    - "TEST-PATTERNS.md exists at project root with copy-paste examples"
    - "Shared fixtures folder exists with reusable test data"
    - "Patterns document includes anti-patterns section"
  artifacts:
    - path: "TEST-PATTERNS.md"
      provides: "Test patterns quick reference"
      min_lines: 100
    - path: "src/__fixtures__/screens.js"
      provides: "Screen test fixtures"
      exports: ["mockScreen", "mockScreenList"]
    - path: "src/__fixtures__/playlists.js"
      provides: "Playlist test fixtures"
      exports: ["mockPlaylist", "mockPlaylistItems"]
    - path: "src/__fixtures__/schedules.js"
      provides: "Schedule test fixtures"
      exports: ["mockSchedule", "mockScheduleSlot"]
  key_links:
    - from: "TEST-PATTERNS.md"
      to: "tests/mocks/"
      via: "documentation reference"
      pattern: "tests/mocks"
---

<objective>
Create shared test fixtures and document testing patterns for future development.

Purpose: Prevent future test maintenance burden by establishing patterns. Developers can copy-paste from TEST-PATTERNS.md instead of reinventing mocks.

Output: TEST-PATTERNS.md at project root, shared fixtures in src/__fixtures__/
</objective>

<execution_context>
@/Users/massimodamico/.claude/get-shit-done/workflows/execute-plan.md
@/Users/massimodamico/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/25-test-infrastructure/25-CONTEXT.md
@.planning/phases/25-test-infrastructure/25-RESEARCH.md
@.planning/phases/25-test-infrastructure/25-01-SUMMARY.md
@tests/setup.js
@tests/mocks/supabase.js
@tests/mocks/loggingService.js
@tests/utils/factories.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create shared fixtures folder</name>
  <files>src/__fixtures__/screens.js, src/__fixtures__/playlists.js, src/__fixtures__/schedules.js, src/__fixtures__/index.js</files>
  <action>
Create `src/__fixtures__/` directory with reusable test data.

**screens.js:**
```javascript
// Mock screen data for tests
export const mockScreen = {
  id: 'screen-123',
  name: 'Test Screen',
  owner_id: 'user-123',
  tenant_id: 'tenant-123',
  status: 'online',
  device_id: 'device-abc',
  api_key: 'api-key-xyz',
  last_seen_at: '2026-01-28T10:00:00Z',
  paired_at: '2026-01-01T00:00:00Z',
  playlist_id: 'playlist-123',
  schedule_id: null,
  screen_group_id: 'group-123',
  language_code: 'en',
};

export const mockScreenList = [
  mockScreen,
  { ...mockScreen, id: 'screen-456', name: 'Screen 2' },
  { ...mockScreen, id: 'screen-789', name: 'Screen 3' },
];

// Factory for custom screens
export function createMockScreen(overrides = {}) {
  return { ...mockScreen, ...overrides };
}
```

**playlists.js:**
```javascript
export const mockPlaylistItem = {
  id: 'item-1',
  position: 0,
  type: 'media',
  mediaType: 'image',
  url: 'https://example.com/image.jpg',
  name: 'Test Image',
  duration: 10,
};

export const mockPlaylist = {
  id: 'playlist-123',
  name: 'Test Playlist',
  owner_id: 'user-123',
  tenant_id: 'tenant-123',
  shuffle: false,
  defaultDuration: 10,
  items: [mockPlaylistItem],
};

export const mockPlaylistItems = [
  mockPlaylistItem,
  { ...mockPlaylistItem, id: 'item-2', position: 1, name: 'Image 2' },
];

export function createMockPlaylist(overrides = {}) {
  return { ...mockPlaylist, ...overrides };
}
```

**schedules.js:**
```javascript
export const mockScheduleSlot = {
  id: 'slot-1',
  schedule_id: 'schedule-123',
  playlist_id: 'playlist-123',
  start_time: '09:00',
  end_time: '17:00',
  days_of_week: [1, 2, 3, 4, 5], // Mon-Fri
  priority: 1,
};

export const mockSchedule = {
  id: 'schedule-123',
  name: 'Test Schedule',
  owner_id: 'user-123',
  tenant_id: 'tenant-123',
  timezone: 'America/New_York',
  slots: [mockScheduleSlot],
};

export function createMockSchedule(overrides = {}) {
  return { ...mockSchedule, ...overrides };
}

export function createMockSlot(overrides = {}) {
  return { ...mockScheduleSlot, ...overrides };
}
```

**index.js (barrel export):**
```javascript
export * from './screens.js';
export * from './playlists.js';
export * from './schedules.js';
```
  </action>
  <verify>
Run: `ls -la src/__fixtures__/`
Should show: screens.js, playlists.js, schedules.js, index.js
  </verify>
  <done>
src/__fixtures__/ exists with screens, playlists, schedules exports.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create TEST-PATTERNS.md documentation</name>
  <files>TEST-PATTERNS.md</files>
  <action>
Create `TEST-PATTERNS.md` at project root (next to README.md).

Format: Cheat sheet style - copy-paste examples, minimal prose.

**Sections to include:**

1. **Quick Start** - How to run tests, common commands

2. **Mock Patterns**
   - Supabase mock (from tests/mocks/supabase.js)
   - loggingService mock (from tests/mocks/loggingService.js)
   - How to use vi.mock with importOriginal

3. **Test Structure**
   - Standard describe/it pattern
   - beforeEach cleanup pattern
   - Async test pattern

4. **Fixtures**
   - How to import from src/__fixtures__/
   - Factory function usage

5. **Common Issues & Solutions**
   - Circular dependency: Solution is global mock in setup.js
   - Mock chain incomplete: Show how to add methods
   - Missing exports in mock: Show importOriginal pattern
   - React act() warnings: Show proper async handling

6. **Anti-Patterns**
   - Inline mock duplication (bad) vs centralized mocks (good)
   - Missing cleanup (bad) vs vi.clearAllMocks (good)
   - Testing implementation (bad) vs testing behavior (good)

Each section should have:
- 2-3 sentence explanation
- Copy-paste code example
- Common gotchas (if any)

Target length: 150-250 lines. Concise but complete.
  </action>
  <verify>
Run: `wc -l TEST-PATTERNS.md && head -30 TEST-PATTERNS.md`
Should show 100+ lines and proper markdown structure.
  </verify>
  <done>
TEST-PATTERNS.md exists at project root with all required sections.
  </done>
</task>

</tasks>

<verification>
1. `src/__fixtures__/` directory exists with 4 files
2. `TEST-PATTERNS.md` exists at project root
3. Patterns document is 100+ lines
4. All fixtures export expected functions
</verification>

<success_criteria>
- TEST-PATTERNS.md exists with mock patterns, anti-patterns, and copy-paste examples
- src/__fixtures__/ has screens.js, playlists.js, schedules.js with factory functions
- Documentation references existing tests/mocks/ files
</success_criteria>

<output>
After completion, create `.planning/phases/25-test-infrastructure/25-02-SUMMARY.md`
</output>
