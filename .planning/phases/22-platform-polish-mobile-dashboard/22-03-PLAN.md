---
phase: 22-platform-polish-mobile-dashboard
plan: 03
type: execute
wave: 2
depends_on: ["22-01"]
files_modified:
  - src/components/dashboard/HealthBanner.jsx
  - src/components/dashboard/ActiveContentGrid.jsx
  - src/components/dashboard/TimelineActivity.jsx
  - src/components/dashboard/QuickActionsBar.jsx
  - src/pages/DashboardPage.jsx
  - src/pages/dashboard/DashboardSections.jsx
  - src/services/dashboardService.js
autonomous: true

must_haves:
  truths:
    - "Dashboard shows health banner for critical alerts at top"
    - "Dashboard displays thumbnail grid of active content on screens"
    - "Dashboard shows timeline-style recent activity feed"
    - "Quick actions accessible from header area"
    - "Dashboard layout adapts to mobile"
  artifacts:
    - path: "src/components/dashboard/HealthBanner.jsx"
      provides: "Critical alert banner for dashboard top"
      exports: ["HealthBanner"]
    - path: "src/components/dashboard/ActiveContentGrid.jsx"
      provides: "Thumbnail grid showing what's playing on screens"
      exports: ["ActiveContentGrid"]
    - path: "src/components/dashboard/TimelineActivity.jsx"
      provides: "Timeline-formatted recent activity"
      exports: ["TimelineActivity"]
    - path: "src/components/dashboard/QuickActionsBar.jsx"
      provides: "Quick action buttons for header area"
      exports: ["QuickActionsBar"]
  key_links:
    - from: "src/pages/DashboardPage.jsx"
      to: "src/components/dashboard/HealthBanner.jsx"
      via: "renders at page top when critical alerts exist"
      pattern: "HealthBanner"
    - from: "src/components/dashboard/ActiveContentGrid.jsx"
      to: "src/services/dashboardService.js"
      via: "getTopScreens for screen content data"
      pattern: "getTopScreens"
---

<objective>
Enhance dashboard with health banner, active content grid, timeline activity, and quick actions bar.

Purpose: Give users a command center view of their digital signage network (DASH-01 through DASH-04).
Output: Enhanced dashboard with actionable overview and health indicators.
</objective>

<execution_context>
@/Users/massimodamico/.claude/get-shit-done/workflows/execute-plan.md
@/Users/massimodamico/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/pages/DashboardPage.jsx
@src/pages/dashboard/DashboardSections.jsx
@src/services/dashboardService.js
@src/hooks/useMediaQuery.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create HealthBanner and QuickActionsBar components</name>
  <files>src/components/dashboard/HealthBanner.jsx, src/components/dashboard/QuickActionsBar.jsx</files>
  <action>
Create HealthBanner that shows at the top when there are critical issues:

```javascript
// src/components/dashboard/HealthBanner.jsx
/**
 * HealthBanner Component
 * Shows critical alert banner at dashboard top when screens are offline.
 */
import { AlertTriangle, ArrowRight, X } from 'lucide-react';
import { useState } from 'react';

export function HealthBanner({ alertSummary, onNavigate }) {
  const [dismissed, setDismissed] = useState(false);

  // Only show for critical issues
  if (!alertSummary || alertSummary.critical === 0 || dismissed) {
    return null;
  }

  const criticalCount = alertSummary.critical;
  const topIssue = alertSummary.topIssues?.find(i => i.severity === 'critical');

  return (
    <div className="bg-red-50 border border-red-200 rounded-lg p-4 flex items-center gap-4">
      <div className="p-2 bg-red-100 rounded-lg flex-shrink-0">
        <AlertTriangle className="w-5 h-5 text-red-600" />
      </div>
      <div className="flex-1 min-w-0">
        <p className="font-medium text-red-900">
          {criticalCount} screen{criticalCount > 1 ? 's' : ''} offline
        </p>
        {topIssue && (
          <p className="text-sm text-red-700 truncate">
            {topIssue.deviceName}: {topIssue.message}
          </p>
        )}
      </div>
      <div className="flex items-center gap-2 flex-shrink-0">
        <button
          onClick={() => onNavigate?.('screens')}
          className="px-3 py-1.5 bg-red-600 text-white text-sm font-medium rounded-lg hover:bg-red-700 transition-colors flex items-center gap-1"
        >
          View Screens
          <ArrowRight className="w-3.5 h-3.5" />
        </button>
        <button
          onClick={() => setDismissed(true)}
          className="p-1.5 text-red-600 hover:text-red-800 hover:bg-red-100 rounded-lg transition-colors"
          aria-label="Dismiss"
        >
          <X className="w-4 h-4" />
        </button>
      </div>
    </div>
  );
}

export default HealthBanner;
```

Create QuickActionsBar for header-area quick actions:

```javascript
// src/components/dashboard/QuickActionsBar.jsx
/**
 * QuickActionsBar Component
 * Quick action buttons for dashboard header area.
 */
import { Plus, Upload, AlertTriangle, BarChart3 } from 'lucide-react';
import { Button } from '../../design-system';

export function QuickActionsBar({ onNavigate, hasEmergency = false }) {
  return (
    <div className="flex items-center gap-2">
      <Button
        variant="secondary"
        size="sm"
        icon={<Plus className="w-4 h-4" />}
        onClick={() => onNavigate?.('screens')}
      >
        <span className="hidden sm:inline">Add Screen</span>
      </Button>
      <Button
        variant="secondary"
        size="sm"
        icon={<Upload className="w-4 h-4" />}
        onClick={() => onNavigate?.('media-all')}
      >
        <span className="hidden sm:inline">Upload</span>
      </Button>
      {hasEmergency && (
        <Button
          variant="secondary"
          size="sm"
          icon={<AlertTriangle className="w-4 h-4 text-amber-600" />}
          onClick={() => {/* Emergency modal handled by Header */}}
          className="border-amber-200 hover:border-amber-300"
        >
          <span className="hidden sm:inline">Emergency</span>
        </Button>
      )}
      <Button
        variant="secondary"
        size="sm"
        icon={<BarChart3 className="w-4 h-4" />}
        onClick={() => onNavigate?.('analytics')}
      >
        <span className="hidden sm:inline">Analytics</span>
      </Button>
    </div>
  );
}

export default QuickActionsBar;
```

Create index.js export file:
```javascript
// src/components/dashboard/index.js
export { HealthBanner } from './HealthBanner';
export { QuickActionsBar } from './QuickActionsBar';
export { PendingApprovalsWidget } from './PendingApprovalsWidget';
// Will add more exports as components are created
```
  </action>
  <verify>Files exist with proper exports</verify>
  <done>HealthBanner shows for critical alerts, QuickActionsBar provides quick navigation</done>
</task>

<task type="auto">
  <name>Task 2: Create ActiveContentGrid and TimelineActivity components</name>
  <files>src/components/dashboard/ActiveContentGrid.jsx, src/components/dashboard/TimelineActivity.jsx</files>
  <action>
Create ActiveContentGrid showing thumbnails of what's playing:

```javascript
// src/components/dashboard/ActiveContentGrid.jsx
/**
 * ActiveContentGrid Component
 * Shows thumbnail previews of content currently playing on screens.
 */
import { Monitor, Wifi, WifiOff, Image } from 'lucide-react';
import { Card, CardHeader, CardTitle, CardContent } from '../../design-system';

export function ActiveContentGrid({ screens = [], onNavigate, loading = false }) {
  if (loading) {
    return (
      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <Monitor className="w-5 h-5 text-gray-400" />
            Active Content
          </CardTitle>
        </CardHeader>
        <CardContent>
          <div className="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3">
            {[...Array(4)].map((_, i) => (
              <div key={i} className="aspect-video bg-gray-100 rounded-lg animate-pulse" />
            ))}
          </div>
        </CardContent>
      </Card>
    );
  }

  if (!screens || screens.length === 0) {
    return (
      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <Monitor className="w-5 h-5 text-gray-400" />
            Active Content
          </CardTitle>
        </CardHeader>
        <CardContent>
          <div className="text-center py-8">
            <Monitor className="w-10 h-10 text-gray-300 mx-auto mb-2" />
            <p className="text-sm text-gray-500">No screens connected yet</p>
          </div>
        </CardContent>
      </Card>
    );
  }

  return (
    <Card>
      <CardHeader
        actions={
          <button
            onClick={() => onNavigate?.('screens')}
            className="text-sm text-gray-500 hover:text-gray-700"
          >
            View all
          </button>
        }
      >
        <CardTitle className="flex items-center gap-2">
          <Monitor className="w-5 h-5 text-gray-400" />
          Active Content
        </CardTitle>
      </CardHeader>
      <CardContent>
        <div className="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3">
          {screens.slice(0, 8).map((screen) => (
            <button
              key={screen.id}
              onClick={() => onNavigate?.('screens')}
              className="group relative aspect-video bg-gray-100 rounded-lg overflow-hidden hover:ring-2 hover:ring-blue-500 transition-all"
            >
              {/* Placeholder or thumbnail */}
              {screen.thumbnail_url ? (
                <img
                  src={screen.thumbnail_url}
                  alt={screen.device_name}
                  className="w-full h-full object-cover"
                />
              ) : (
                <div className="w-full h-full flex items-center justify-center bg-gradient-to-br from-gray-100 to-gray-200">
                  <Image className="w-6 h-6 text-gray-400" />
                </div>
              )}
              {/* Overlay with screen name */}
              <div className="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent opacity-0 group-hover:opacity-100 transition-opacity flex items-end p-2">
                <p className="text-white text-xs font-medium truncate w-full">
                  {screen.device_name || 'Unnamed'}
                </p>
              </div>
              {/* Online indicator */}
              <div className="absolute top-2 right-2">
                {screen.isOnline ? (
                  <Wifi className="w-3.5 h-3.5 text-green-400 drop-shadow" />
                ) : (
                  <WifiOff className="w-3.5 h-3.5 text-gray-400 drop-shadow" />
                )}
              </div>
            </button>
          ))}
        </div>
      </CardContent>
    </Card>
  );
}

export default ActiveContentGrid;
```

Create TimelineActivity with timeline-style format:

```javascript
// src/components/dashboard/TimelineActivity.jsx
/**
 * TimelineActivity Component
 * Shows recent activity in timeline format with connecting line.
 */
import { Activity, ListVideo, Image, Video, Upload, Edit, PlusCircle, Loader2 } from 'lucide-react';
import { Card, CardHeader, CardTitle, CardContent } from '../../design-system';
import { formatLastSeen } from '../../services/dashboardService';

export function TimelineActivity({ activities = [], onNavigate, loading = false }) {
  const getActivityIcon = (activity) => {
    if (activity.type === 'playlist') return <ListVideo className="w-4 h-4 text-purple-600" />;
    if (activity.mediaType === 'video') return <Video className="w-4 h-4 text-blue-600" />;
    return <Image className="w-4 h-4 text-orange-600" />;
  };

  const getActionIcon = (action) => {
    switch (action) {
      case 'created': return <PlusCircle className="w-3 h-3" />;
      case 'updated': return <Edit className="w-3 h-3" />;
      case 'uploaded': return <Upload className="w-3 h-3" />;
      default: return <Activity className="w-3 h-3" />;
    }
  };

  if (loading) {
    return (
      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <Activity className="w-5 h-5 text-gray-400" />
            Recent Activity
          </CardTitle>
        </CardHeader>
        <CardContent>
          <div className="flex justify-center py-8">
            <Loader2 className="w-6 h-6 animate-spin text-gray-400" />
          </div>
        </CardContent>
      </Card>
    );
  }

  if (!activities || activities.length === 0) {
    return (
      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <Activity className="w-5 h-5 text-gray-400" />
            Recent Activity
          </CardTitle>
        </CardHeader>
        <CardContent>
          <p className="text-sm text-gray-500 text-center py-4">No recent activity</p>
        </CardContent>
      </Card>
    );
  }

  return (
    <Card>
      <CardHeader>
        <CardTitle className="flex items-center gap-2">
          <Activity className="w-5 h-5 text-gray-400" />
          Recent Activity
        </CardTitle>
      </CardHeader>
      <CardContent>
        {/* Timeline */}
        <div className="relative">
          {/* Vertical line */}
          <div className="absolute left-[19px] top-2 bottom-2 w-px bg-gray-200" />

          <div className="space-y-4">
            {activities.map((activity, index) => (
              <button
                key={`${activity.type}-${activity.id}`}
                onClick={() => onNavigate?.(activity.type === 'playlist' ? 'playlists' : 'media-all')}
                className="relative flex items-start gap-4 w-full text-left hover:bg-gray-50 -mx-2 px-2 py-1 rounded-lg transition-colors"
              >
                {/* Timeline dot */}
                <div className="relative z-10 flex-shrink-0 w-10 h-10 bg-white border-2 border-gray-200 rounded-full flex items-center justify-center">
                  {getActivityIcon(activity)}
                </div>

                {/* Content */}
                <div className="flex-1 min-w-0 pt-1">
                  <p className="text-sm font-medium text-gray-900 truncate" title={activity.name}>
                    {activity.name}
                  </p>
                  <p className="text-xs text-gray-500 flex items-center gap-1 mt-0.5">
                    {getActionIcon(activity.action)}
                    <span className="capitalize">{activity.action}</span>
                    <span className="text-gray-300 mx-1">Â·</span>
                    {formatLastSeen(activity.timestamp)}
                  </p>
                </div>

                {/* Thumbnail if available */}
                {activity.thumbnail && (
                  <img
                    src={activity.thumbnail}
                    alt=""
                    className="w-10 h-10 object-cover rounded flex-shrink-0"
                  />
                )}
              </button>
            ))}
          </div>
        </div>
      </CardContent>
    </Card>
  );
}

export default TimelineActivity;
```

Update the index export:
```javascript
// src/components/dashboard/index.js
export { HealthBanner } from './HealthBanner';
export { QuickActionsBar } from './QuickActionsBar';
export { ActiveContentGrid } from './ActiveContentGrid';
export { TimelineActivity } from './TimelineActivity';
export { PendingApprovalsWidget } from './PendingApprovalsWidget';
```
  </action>
  <verify>Files exist and export components correctly</verify>
  <done>ActiveContentGrid shows screen thumbnails, TimelineActivity shows timeline-formatted feed</done>
</task>

<task type="auto">
  <name>Task 3: Integrate new components into DashboardPage</name>
  <files>src/pages/DashboardPage.jsx</files>
  <action>
Update DashboardPage to use the new dashboard components:

1. Add imports:
```javascript
import {
  HealthBanner,
  QuickActionsBar,
  ActiveContentGrid,
  TimelineActivity,
} from '../components/dashboard';
import { useBreakpoints } from '../hooks/useMediaQuery';
```

2. Add breakpoint check in component:
```javascript
const { isMobile, isDesktop } = useBreakpoints();
```

3. Update PageHeader to include QuickActionsBar on desktop:
```javascript
<PageHeader
  title={t('dashboard.title', 'Dashboard')}
  description={t('dashboard.welcomeSubtitle', "Welcome back! Here's your digital signage overview")}
  actions={
    !isMobile && (
      <QuickActionsBar onNavigate={setCurrentPage} />
    )
  }
/>
```

4. Add HealthBanner at top of PageContent (before other content):
```javascript
<PageContent>
  <Stack gap="lg">
    {/* Health Banner - critical alerts at top */}
    <HealthBanner alertSummary={alertSummary} onNavigate={setCurrentPage} />

    {/* Existing welcome sections... */}
```

5. Replace or enhance the two-column layout section. Add ActiveContentGrid:
```javascript
{/* Active Content Grid - shows what's playing */}
<ActiveContentGrid
  screens={screens}
  onNavigate={setCurrentPage}
  loading={loading}
/>

{/* Two Column Layout - existing Screens Overview and Quick Actions */}
<div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
  {/* Keep existing Screens Overview card */}
  {/* Keep existing Quick Actions card - or simplify since QuickActionsBar exists */}
</div>
```

6. Replace RecentActivityWidget with TimelineActivity:
```javascript
{/* Second Row - Timeline Activity & Alerts */}
<div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
  <TimelineActivity
    activities={recentActivity}
    onNavigate={setCurrentPage}
    loading={activityLoading}
  />
  <AlertsWidget
    alertSummary={alertSummary}
    setCurrentPage={setCurrentPage}
    t={t}
    loading={alertsLoading}
  />
</div>
```

7. On mobile, show QuickActionsBar in a card instead of header:
```javascript
{isMobile && (
  <Card padding="default" className="lg:hidden">
    <CardContent>
      <QuickActionsBar onNavigate={setCurrentPage} />
    </CardContent>
  </Card>
)}
```

The layout order should be:
1. HealthBanner (if critical alerts)
2. Welcome/Onboarding sections (if applicable)
3. Stats Grid
4. Active Content Grid
5. Quick Actions (mobile only card)
6. Screens Overview + Quick Actions (desktop two-column)
7. Timeline Activity + Alerts (two-column)
8. Getting Started Tips (if empty workspace)
  </action>
  <verify>Dashboard shows health banner when alerts exist, active content grid, timeline activity</verify>
  <done>DashboardPage enhanced with all DASH requirements</done>
</task>

</tasks>

<verification>
1. HealthBanner appears at top when critical alerts exist (DASH-03)
2. ActiveContentGrid shows screen thumbnails (DASH-01)
3. TimelineActivity shows recent changes in timeline format (DASH-04)
4. QuickActionsBar provides add screen, upload, analytics access (DASH-02)
5. Dashboard layout responsive - stacks on mobile, two-column on desktop
6. All new components integrate with existing dashboard data flow
</verification>

<success_criteria>
- Dashboard shows health banner for critical screen issues
- Active content grid displays what's playing on screens
- Timeline activity shows recent changes with visual timeline
- Quick actions accessible from header (desktop) or card (mobile)
- Dashboard adapts layout for mobile screens
</success_criteria>

<output>
After completion, create `.planning/phases/22-platform-polish-mobile-dashboard/22-03-SUMMARY.md`
</output>
