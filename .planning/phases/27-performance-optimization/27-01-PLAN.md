---
phase: 27-performance-optimization
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - .planning/phases/27-performance-optimization/27-BASELINE.md
autonomous: true

must_haves:
  truths:
    - "npm run analyze builds and opens bundle visualization"
    - "Baseline metrics are documented with gzipped sizes"
    - "Player chunk contents are analyzed and documented"
  artifacts:
    - path: "package.json"
      provides: "analyze script"
      contains: '"analyze":'
    - path: ".planning/phases/27-performance-optimization/27-BASELINE.md"
      provides: "Bundle baseline documentation"
      min_lines: 50
  key_links:
    - from: "package.json"
      to: "perf-reports/bundle-stats.html"
      via: "npm run analyze script"
      pattern: '"analyze".*build'
---

<objective>
Analyze bundle and establish baseline metrics for optimization

Purpose: Create documented baseline before any optimizations so improvements can be measured. The research identified that the Player chunk (274KB) may contain unnecessary dependencies that warrant investigation.

Output: `npm run analyze` script, baseline documentation in `.planning/`, and analysis of optimization opportunities
</objective>

<execution_context>
@/Users/massimodamico/.claude/get-shit-done/workflows/execute-plan.md
@/Users/massimodamico/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/27-performance-optimization/27-RESEARCH.md
@.planning/phases/27-performance-optimization/27-CONTEXT.md
@vite.config.js
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add analyze script and generate fresh baseline</name>
  <files>package.json</files>
  <action>
Add `npm run analyze` script to package.json scripts section:
```json
"analyze": "npm run build && open perf-reports/bundle-stats.html"
```

This leverages the existing rollup-plugin-visualizer configuration in vite.config.js which already outputs to perf-reports/bundle-stats.html with gzip and brotli sizes enabled.

Run `npm run build` to generate fresh bundle statistics. The visualizer will create/update perf-reports/bundle-stats.html during the build.
  </action>
  <verify>
- `npm run build` completes successfully
- `perf-reports/bundle-stats.html` is updated with current timestamp
- Script is in package.json
  </verify>
  <done>
`npm run analyze` script exists and `perf-reports/bundle-stats.html` contains fresh build data
  </done>
</task>

<task type="auto">
  <name>Task 2: Document baseline metrics</name>
  <files>.planning/phases/27-performance-optimization/27-BASELINE.md</files>
  <action>
Create baseline documentation by analyzing the build output and perf-reports/bundle-stats.html.

Document these metrics:

**Build Summary:**
- Total JS files (chunk count)
- Total bundle size (uncompressed)
- Total bundle size (gzipped)
- Build time

**Initial Load Analysis:**
List chunks loaded on initial page load with sizes (gzip and raw):
- index-*.js (entry point)
- vendor-react-*.js
- vendor-supabase-*.js
- vendor-motion-*.js (note: preloaded but may not be needed)
- vendor-icons-*.js

**Route Chunks:**
Document sizes for major route chunks:
- Player-*.js
- App-*.js (dashboard)
- SvgEditorPage-*.js
- Other significant chunks (>50KB)

**Format:**
```markdown
# Phase 27: Bundle Baseline

**Generated:** [date]
**Build tool:** Vite 7.2.2

## Summary
| Metric | Value |
|--------|-------|
| Total JS chunks | X files |
| Total size (raw) | X MB |
| Total size (gzip) | X MB |
| Initial load (gzip) | X KB |

## Initial Load Chunks
[table of preloaded chunks]

## Route Chunks
[table of route chunks]

## Observations
[Key findings from analysis]
```
  </action>
  <verify>
- File exists at `.planning/phases/27-performance-optimization/27-BASELINE.md`
- Contains gzipped sizes (not just raw)
- Contains initial load analysis
- Contains route chunk sizes
  </verify>
  <done>
Baseline documentation exists with all required metrics including gzipped sizes
  </done>
</task>

<task type="auto">
  <name>Task 3: Analyze Player chunk and identify opportunities</name>
  <files>.planning/phases/27-performance-optimization/27-BASELINE.md</files>
  <action>
Investigate what's making the Player chunk 274KB (per research) when Player.jsx is only 23 lines.

Analysis steps:
1. Open perf-reports/bundle-stats.html in browser
2. Find the Player chunk in the treemap visualization
3. Document what modules are bundled into the Player chunk
4. Identify if Player is pulling in dashboard code or other unnecessary dependencies

Look for:
- Does Player chunk include any dashboard components?
- Does Player chunk include services not used by player?
- Are barrel exports (player/components/index.js) pulling in unused code?
- What are the largest modules in the Player chunk?

Add "Optimization Opportunities" section to 27-BASELINE.md:
```markdown
## Optimization Opportunities

### Player Route Analysis
Player chunk contents:
- [List modules bundled]
- [Identify unexpected dependencies]

Potential optimizations:
- [List specific opportunities with estimated impact]

### Tree Shaking Candidates
- sideEffects: false (not currently in package.json)
- [Other barrel export concerns]

### Preload Review
- vendor-motion currently preloaded (~113KB gzip)
- [Assessment of whether preload is needed on initial routes]
```
  </action>
  <verify>
- 27-BASELINE.md contains "Optimization Opportunities" section
- Player chunk contents are documented
- Specific optimization recommendations are listed
  </verify>
  <done>
Player chunk is analyzed, contents documented, and optimization opportunities identified
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npm run analyze` - script runs and opens bundle visualization
2. `.planning/phases/27-performance-optimization/27-BASELINE.md` exists with complete metrics
3. Optimization opportunities are documented with specific recommendations for Plan 27-02
</verification>

<success_criteria>
- `npm run analyze` script works (builds and opens report)
- Baseline metrics documented with gzipped sizes
- Player chunk contents analyzed and documented
- Optimization opportunities identified for Phase 27 Plan 02
- PERF-01 requirement satisfied (bundle analysis report with baseline)
</success_criteria>

<output>
After completion, create `.planning/phases/27-performance-optimization/27-01-SUMMARY.md`
</output>
