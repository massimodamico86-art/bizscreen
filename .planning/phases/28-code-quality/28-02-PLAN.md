---
phase: 28-code-quality
plan: 02
type: execute
wave: 2
depends_on: [28-01]
files_modified:
  - eslint.config.js
  - README.md
  - src/components/**/*.jsx
  - src/services/**/*.js
  - src/hooks/**/*.js
autonomous: true

must_haves:
  truths:
    - "Core components have PropTypes with shape-level detail"
    - "Exported service functions have JSDoc with @param and @returns"
    - "README covers setup and architecture for developer onboarding"
    - "Complex business logic has inline comments explaining intent"
  artifacts:
    - path: "eslint.config.js"
      provides: "react/prop-types and jsdoc rules enabled"
      contains: "react/prop-types"
    - path: "README.md"
      provides: "Developer onboarding documentation"
      min_lines: 100
    - path: "src/components/Button.jsx"
      provides: "Example PropTypes pattern"
      contains: "PropTypes.shape"
  key_links:
    - from: "eslint.config.js"
      to: "eslint-plugin-react"
      via: "react/prop-types rule"
      pattern: "react/prop-types.*error"
    - from: "eslint.config.js"
      to: "eslint-plugin-jsdoc"
      via: "jsdoc/require-jsdoc rule"
      pattern: "jsdoc/require-jsdoc"
---

<objective>
Add type annotations (PropTypes, JSDoc) and documentation to the codebase. Enable ESLint rules to enforce these standards going forward. Update README for developer onboarding.

Purpose: Improve code maintainability through self-documenting code and proper documentation
Output: PropTypes on core components, JSDoc on services, updated README, inline comments on complex logic
</objective>

<execution_context>
@/Users/massimodamico/.claude/get-shit-done/workflows/execute-plan.md
@/Users/massimodamico/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/28-code-quality/28-CONTEXT.md
@.planning/phases/28-code-quality/28-RESEARCH.md
@.planning/phases/28-code-quality/28-01-SUMMARY.md
@eslint.config.js
@README.md
@src/services/loggingService.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add PropTypes to core components and JSDoc to key services</name>
  <files>
eslint.config.js
src/components/Button.jsx
src/components/Card.jsx
src/components/Modal.jsx
src/components/Badge.jsx
src/components/Toast.jsx
src/components/Skeleton.jsx
src/components/FeatureGate.jsx
src/services/authService.js
src/services/screenService.js
src/services/playlistService.js
src/hooks/useAuth.js
src/hooks/useScreens.js
  </files>
  <action>
1. Install eslint-plugin-react and eslint-plugin-jsdoc:
   ```bash
   npm install --save-dev eslint-plugin-react eslint-plugin-jsdoc
   ```

2. Update eslint.config.js to add PropTypes and JSDoc enforcement:
   - Import eslint-plugin-react and eslint-plugin-jsdoc
   - Add react plugin with settings: { react: { version: 'detect' } }
   - Add jsdoc plugin
   - Add rules (start as 'warn' to avoid blocking commits during migration):
     ```javascript
     'react/prop-types': 'warn',
     'jsdoc/require-jsdoc': ['warn', {
       publicOnly: true,
       require: { FunctionDeclaration: true },
       contexts: ['ExportNamedDeclaration > FunctionDeclaration'],
     }],
     'jsdoc/require-param': 'warn',
     'jsdoc/require-returns': 'warn',
     ```
   - Disable these rules for test files

3. Add PropTypes to core UI components (with shape-level detail):

   Pattern to follow (from RESEARCH.md):
   ```javascript
   import PropTypes from 'prop-types';

   ComponentName.propTypes = {
     // Required props marked with isRequired
     id: PropTypes.string.isRequired,
     // Objects use shape, not just PropTypes.object
     config: PropTypes.shape({
       key: PropTypes.string,
       value: PropTypes.any,
     }),
     // Arrays use arrayOf
     items: PropTypes.arrayOf(PropTypes.shape({
       id: PropTypes.string.isRequired,
       name: PropTypes.string,
     })),
     // Functions
     onClick: PropTypes.func,
     // Enums
     variant: PropTypes.oneOf(['primary', 'secondary', 'danger']),
   };

   ComponentName.defaultProps = {
     config: null,
     onClick: null,
     variant: 'primary',
   };
   ```

   Components to add PropTypes:
   - Button.jsx: children, onClick, variant, size, disabled, loading, type, className
   - Card.jsx: children, title, className, onClick
   - Modal.jsx: isOpen, onClose, title, children, size
   - Badge.jsx: children, variant, size
   - Toast.jsx: message, type, onDismiss, duration
   - Skeleton.jsx: width, height, className, variant
   - FeatureGate.jsx: feature, children, fallback

4. Add JSDoc to key service functions:

   Pattern to follow:
   ```javascript
   /**
    * Brief description of what the function does
    *
    * @param {Object} options - Description of options object
    * @param {string} options.id - Description of id
    * @param {number} [options.limit=10] - Optional param with default
    * @returns {Promise<{data: Object, error: Error|null}>} Description of return
    * @throws {Error} When the function might throw
    */
   export async function functionName(options) { ... }
   ```

   Services to add JSDoc:
   - authService.js: signIn, signOut, signUp, resetPassword, getCurrentUser
   - screenService.js: getScreens, createScreen, updateScreen, deleteScreen
   - playlistService.js: getPlaylists, createPlaylist, updatePlaylist

5. Add JSDoc to key hooks:
   - useAuth.js: Document return shape { user, loading, signIn, signOut, ... }
   - useScreens.js: Document return shape { screens, loading, error, refresh }

6. Run `npm run lint` - new warnings should appear for missing PropTypes/JSDoc
   (warnings are OK since rules are set to 'warn', not 'error')
  </action>
  <verify>
# Check plugins installed
grep "eslint-plugin-react" package.json && grep "eslint-plugin-jsdoc" package.json
# Both should appear

# Check eslint.config.js has new rules
grep "react/prop-types" eslint.config.js && grep "jsdoc/require-jsdoc" eslint.config.js
# Both should appear

# Check PropTypes added to core components
grep "PropTypes" src/components/Button.jsx && grep "PropTypes" src/components/Modal.jsx
# Should show PropTypes imports

# Check JSDoc added to services
grep "@param" src/services/authService.js && grep "@returns" src/services/screenService.js
# Should show JSDoc patterns

# Lint still passes (rules are warn, not error)
npm run lint 2>&1 | tail -3
# Should still show 0 errors
  </verify>
  <done>
- eslint-plugin-react and eslint-plugin-jsdoc installed
- eslint.config.js has react/prop-types and jsdoc rules (as warnings)
- Core components (Button, Card, Modal, Badge, Toast, Skeleton, FeatureGate) have PropTypes
- Key services (authService, screenService, playlistService) have JSDoc
- Key hooks (useAuth, useScreens) have JSDoc
  </done>
</task>

<task type="auto">
  <name>Task 2: Update README and add inline comments to complex logic</name>
  <files>
README.md
src/services/scheduleService.js
src/services/offlineService.js
src/player/hooks/useContentSync.js
src/services/campaignService.js
  </files>
  <action>
1. Rewrite README.md for developer onboarding:

   Structure:
   ```markdown
   # BizScreen

   Digital signage platform for managing screen content across locations.

   ## Quick Start

   ### Prerequisites
   - Node.js 20+
   - Supabase CLI (for local development)

   ### Installation
   ```bash
   npm install
   cp .env.example .env.local
   # Configure Supabase credentials in .env.local
   npm run dev
   ```

   ## Architecture

   ### Tech Stack
   - React 19 + Vite
   - Supabase (auth, database, storage)
   - TailwindCSS
   - Polotno (template editor)

   ### Project Structure
   ```
   src/
   ├── components/     # Reusable UI components
   ├── pages/          # Route pages
   ├── services/       # API and business logic
   ├── hooks/          # React hooks
   ├── player/         # Player app (runs on screens)
   └── utils/          # Helper functions
   ```

   ### Key Concepts
   - **Scenes**: Visual layouts created in the editor
   - **Playlists**: Ordered collections of scenes with durations
   - **Screens**: Physical display devices
   - **Campaigns**: Scheduled content delivery to screens

   ## Development

   ### Running Tests
   ```bash
   npm test              # Unit tests
   npm run test:e2e      # E2E tests (requires running app)
   ```

   ### Code Quality
   - ESLint runs on pre-commit via Husky
   - PropTypes required for components
   - JSDoc required for exported functions

   ### Key Services
   - `authService.js` - Authentication and user management
   - `screenService.js` - Screen CRUD and status
   - `playlistService.js` - Playlist management
   - `scheduleService.js` - Campaign scheduling with timezone support

   ## Deployment

   Deployed via Vercel. Push to main triggers production deploy.
   ```

2. Add inline comments to complex business logic (explain WHY, not WHAT):

   a. scheduleService.js - Schedule resolution logic:
   ```javascript
   // Campaign priority order: Emergency > Active Campaign > Device Scene
   // Emergency campaigns bypass all other content to ensure urgent messages
   // reach screens immediately, even if offline (syncs when reconnected)
   ```

   b. offlineService.js - Offline sync strategy:
   ```javascript
   // IndexedDB stores content for offline playback. Sync strategy:
   // 1. Prefetch: Download all playlist content on screen pairing
   // 2. Background: Periodic sync every 5 minutes when online
   // 3. Reconnect: Full sync when connection restored after offline period
   // This ensures screens show content even without network connectivity
   ```

   c. useContentSync.js - Content resolution:
   ```javascript
   // Three-level language fallback: device > tenant > 'en'
   // If content isn't available in device language, fall back to tenant
   // default, then English. This ensures screens always show something
   // rather than blank content for unsupported languages.
   ```

   d. campaignService.js - Weighted rotation:
   ```javascript
   // VOLATILE function due to random() - can't be cached by Postgres
   // Rotation weights use weighted random selection: higher weight = higher
   // probability of selection, but not guaranteed order. This provides
   // fair distribution while maintaining variety in content playback.
   ```

3. Remove any commented-out code found during review - git has history

4. Run final lint check to ensure no new errors introduced
  </action>
  <verify>
# Check README has key sections
grep "Quick Start" README.md && grep "Architecture" README.md && grep "Development" README.md
# All sections should exist

# Check README has reasonable length
wc -l README.md
# Should be 100+ lines

# Check inline comments added
grep "Emergency campaigns" src/services/scheduleService.js
grep "IndexedDB" src/services/offlineService.js
grep "language fallback" src/player/hooks/useContentSync.js
# Comments should exist

# Lint passes
npm run lint 2>&1 | tail -3
# Should show 0 errors

# Tests pass
npm test
# Should pass
  </verify>
  <done>
- README.md rewritten with Quick Start, Architecture, Development, Deployment sections
- README is 100+ lines with Mermaid-compatible structure
- Complex business logic has inline comments explaining intent
- No commented-out code remains
- All tests pass
  </done>
</task>

</tasks>

<verification>
1. PropTypes exist: `grep -r "PropTypes" src/components/Button.jsx` shows usage
2. JSDoc exists: `grep "@param" src/services/authService.js` shows JSDoc
3. README complete: `wc -l README.md` shows 100+ lines
4. Comments explain why: `grep "Emergency" src/services/scheduleService.js` shows intent comment
5. All tests pass: `npm test` succeeds
6. Lint clean: `npm run lint` shows 0 errors
</verification>

<success_criteria>
- Core components (7+) have complete PropTypes with shape-level detail
- Key services (3+) and hooks (2+) have JSDoc documentation
- README covers setup, architecture, and development workflow
- Complex business logic files have inline comments explaining business intent
- Zero ESLint errors, all tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/28-code-quality/28-02-SUMMARY.md`
</output>
