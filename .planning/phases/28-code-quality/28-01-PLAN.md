---
phase: 28-code-quality
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - eslint.config.js
  - package.json
  - .husky/pre-commit
autonomous: true

must_haves:
  truths:
    - "ESLint runs with zero errors after ignoring vendored code"
    - "Commits are blocked if staged files have ESLint errors"
    - "Auto-fix resolves most unused imports without manual intervention"
  artifacts:
    - path: "eslint.config.js"
      provides: "Updated ignores for yodeck-capture, _api-disabled, public"
      contains: "yodeck-capture"
    - path: ".husky/pre-commit"
      provides: "Pre-commit hook running lint-staged"
      contains: "lint-staged"
    - path: "package.json"
      provides: "lint-staged config and husky prepare script"
      contains: "lint-staged"
  key_links:
    - from: ".husky/pre-commit"
      to: "lint-staged"
      via: "npx lint-staged command"
      pattern: "npx lint-staged"
    - from: "package.json lint-staged"
      to: "eslint"
      via: "eslint --fix on staged files"
      pattern: "eslint.*--fix"
---

<objective>
Establish ESLint enforcement with pre-commit hooks. Fix all existing violations by updating ignores for vendored code and auto-fixing the remaining issues. Install Husky and lint-staged for pre-commit enforcement.

Purpose: Enable quality gates that prevent new violations from being committed
Output: Zero ESLint errors, working pre-commit hook that blocks bad commits
</objective>

<execution_context>
@/Users/massimodamico/.claude/get-shit-done/workflows/execute-plan.md
@/Users/massimodamico/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/28-code-quality/28-CONTEXT.md
@.planning/phases/28-code-quality/28-RESEARCH.md
@eslint.config.js
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update ESLint ignores and fix auto-fixable violations</name>
  <files>eslint.config.js</files>
  <action>
1. Update eslint.config.js ignores array to include vendored/captured code:
   - Add 'yodeck-capture/**' (captured JS from competitor analysis)
   - Add '_api-disabled/**' (disabled API routes)
   - Add 'public/**' (static assets including polotno-editor.js)

2. Run `npm run lint` to verify violations reduced to ~4,000 (src/ + tests/ only)

3. Run `npx eslint . --fix` to auto-fix all fixable violations:
   - Most no-unused-vars (unused imports) will be auto-removed
   - CAUTION: Review changes to ensure no needed imports removed

4. Run `npm run lint` again to count remaining violations

5. For remaining violations, address manually by category:
   - no-console: Replace with loggingService imports (use log.info, log.debug, log.error)
   - react-hooks/exhaustive-deps: Add missing dependencies or disable with eslint-disable comment + explanation
   - no-undef: Add missing imports or declare as globals
   - no-case-declarations: Wrap case contents in blocks { }

6. Run `npm run lint` - must show 0 errors (warnings OK)

7. Run `npm test` to ensure no regressions from import removal
  </action>
  <verify>
npm run lint 2>&1 | tail -3
# Should show: "0 errors" (warnings are acceptable)

npm test
# Should pass (no regressions from removed imports)
  </verify>
  <done>
- eslint.config.js has updated ignores for yodeck-capture/**, _api-disabled/**, public/**
- `npm run lint` reports 0 errors
- `npm test` passes
  </done>
</task>

<task type="auto">
  <name>Task 2: Install Husky and lint-staged for pre-commit enforcement</name>
  <files>package.json, .husky/pre-commit</files>
  <action>
1. Install dependencies:
   ```bash
   npm install --save-dev husky lint-staged
   ```

2. Initialize Husky (creates .husky directory and adds prepare script to package.json):
   ```bash
   npx husky init
   ```

3. Replace .husky/pre-commit content with lint-staged:
   ```bash
   echo "npx lint-staged" > .husky/pre-commit
   ```

4. Add lint-staged configuration to package.json:
   ```json
   "lint-staged": {
     "*.{js,jsx}": [
       "eslint --fix"
     ]
   }
   ```

5. Test the pre-commit hook:
   - Make a trivial change to any .js file (add a comment)
   - Stage it: `git add -p` (select the changed file)
   - Attempt commit: `git commit -m "test: verify lint-staged"`
   - Hook should run ESLint on staged files
   - If passes, reset: `git reset HEAD~1` (undo test commit)

6. Verify lint-staged catches violations:
   - Add intentional violation: `console.log('test');` in any src file
   - Stage and attempt commit
   - Hook should FAIL with no-console error
   - Remove the intentional violation
  </action>
  <verify>
# Check Husky installed
ls -la .husky/pre-commit
# Should exist

# Check lint-staged config in package.json
grep -A3 "lint-staged" package.json
# Should show configuration

# Check prepare script
grep '"prepare"' package.json
# Should show: "prepare": "husky"

# Functional test - make trivial change and commit
echo "// test" >> eslint.config.js && git add eslint.config.js && git commit -m "test: husky" && git reset HEAD~1 && git checkout eslint.config.js
# Should succeed (no lint errors)
  </verify>
  <done>
- husky and lint-staged installed as devDependencies
- .husky/pre-commit runs lint-staged
- package.json has lint-staged config and prepare script
- Pre-commit hook successfully blocks commits with ESLint errors
  </done>
</task>

</tasks>

<verification>
1. ESLint runs clean: `npm run lint` shows 0 errors
2. Tests pass: `npm test` completes successfully
3. Pre-commit works: Commits with ESLint errors are blocked
4. Pre-commit is fast: Only staged files are linted (not entire codebase)
</verification>

<success_criteria>
- Zero ESLint errors in committed code (warnings acceptable)
- Pre-commit hook installed and functional
- Husky + lint-staged configured in package.json
- No regressions in test suite
</success_criteria>

<output>
After completion, create `.planning/phases/28-code-quality/28-01-SUMMARY.md`
</output>
